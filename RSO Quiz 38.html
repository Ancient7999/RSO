<!DOCTYPE html><html lang="en"><head>  <meta charset="UTF-8">  <title>Radiation Protection Quiz</title>  <style>    /* Base styles */:root {  --accent-0: #00ffff;  --accent-0-rgb: 0, 255, 255;  --accent-1: #00e5e5;  --accent-1-rgb: 0, 229, 229;  --accent-2: #00cccc;  --accent-2-rgb: 0, 204, 204;  --accent-3: #00aaaa;  --accent-3-rgb: 0, 170, 170;  --accent-4: #008888;  --accent-4-rgb: 0, 136, 136;  --accent-5: #004444;  --accent-5-rgb: 0, 68, 68;  --accent-6: #0096ff;  --accent-6-rgb: 0, 150, 255;  --accent-7: #0064ff;  --accent-7-rgb: 0, 100, 255;  --accent-8: #00b4ff;  --accent-8-rgb: 0, 180, 255;  --accent-9: #0082b4;  --accent-9-rgb: 0, 130, 180;}body {  background-color: #0d0d0d; /* Very dark background */  color: #ccc; /* Softer gray text */  font-family: "Segoe UI", sans-serif;  padding: 20px;  margin: 0;}.settings-btn {  position: absolute;  top: 25px;  right: 30px;  background: transparent;  border: 2px solid var(--accent-0);  color: var(--accent-0);  font-size: 28px;  width: 52px;  height: 52px;  border-radius: 50%;  cursor: pointer;  transition: all 0.4s ease;  box-shadow: 0 0 15px rgba(var(--accent-0-rgb), 0.6);  z-index: 100;}.settings-btn:hover {  background: rgba(var(--accent-0-rgb), 0.15);  transform: rotate(90deg) scale(1.15);  box-shadow: 0 0 25px rgba(var(--accent-0-rgb), 0.9);}/* Modal styles */.modal {  position: fixed;  top: 0; left: 0; width: 100%; height: 100%;  background: rgba(13,13,13,0.95);  z-index: 9999;  display: none;  align-items: center;  justify-content: center;}.modal-content {  background: #1a1a1a;  border: 3px solid var(--accent-0);  border-radius: 16px;  padding: 35px 45px;  max-width: 420px;  box-shadow: 0 0 50px rgba(var(--accent-0-rgb), 0.8);  text-align: center;  color: #ccc;}.close-modal {  position: absolute;  top: 12px;  right: 25px;  font-size: 2.4em;  cursor: pointer;  color: var(--accent-0);}.close-modal:hover { color: #ff00ff; transform: scale(1.3); }.setting-item { margin: 30px 0; }.setting-item label {  font-size: 1.15em;  color: var(--accent-0);  display: block;  margin-bottom: 10px;}/* ==================== NEW: ADD SECTION CARD ==================== */    .add-section-card {      border: 3px dashed var(--accent-0) !important;      background-color: rgba(var(--accent-0-rgb), 0.08) !important;      color: var(--accent-0) !important;      opacity: 0.9;      min-height: 170px;    }    .add-section-card:hover {      opacity: 1;      transform: scale(1.08) !important;      box-shadow: 0 0 30px rgba(var(--accent-0-rgb), 0.7) !important;      background-color: rgba(var(--accent-0-rgb), 0.15) !important;    }    .add-section-card .card-inner {      display: flex;      align-items: center;      justify-content: center;      flex-direction: column;      height: 100%;      gap: 12px;    }/* ==================== EDIT MODE TOGGLE SWITCH (Settings Modal) ==================== */.toggle-label {  display: flex;  align-items: center;  justify-content: space-between;  width: 100%;  font-size: 1.15em;  color: var(--accent-0);  margin-bottom: 8px;}.toggle-switch {  position: relative;  display: inline-block;  width: 62px;  height: 34px;  flex-shrink: 0;}.toggle-switch input {   opacity: 0;   width: 0;   height: 0; }.slider {  position: absolute;  cursor: pointer;  top: 0; left: 0; right: 0; bottom: 0;  background-color: #333;  transition: .4s;  border-radius: 34px;  border: 2px solid #555;}.slider:before {  position: absolute;  content: "";  height: 26px;  width: 26px;  left: 4px;  bottom: 4px;  background-color: #ccc;  transition: .4s;  border-radius: 50%;}input:checked + .slider {  background-color: var(--accent-0);  border-color: var(--accent-0);}input:checked + .slider:before {  transform: translateX(28px);  background-color: #0d0d0d;}	/* Header styles */.quiz-header {  position: sticky;  top: 0;  background: #1a1a1a;  z-index: 101;  box-shadow: 0 0 20px rgba(var(--accent-0-rgb), 0.5);  padding: 10px 20px;  transition: font-size 0.3s ease;}/* Use a media query for low-res monitors */@media (max-width: 600px) {  .quiz-header {    padding: 8px 10px;    font-size: 0.9em;  }}/* Main page header – bigger & cyan like Exam 6 */#section-selection .header {  text-align: center;  margin-bottom: 40px;}#section-selection .header h1 {  color: var(--accent-0);  margin: 0 0 12px 0;  font-size: 3em;  font-weight: bold;  text-shadow: 0 0 10px rgba(var(--accent-0-rgb), 0.7);  letter-spacing: 1px;}#section-selection .header p {  color: #aaaaaa;  font-size: 1.2em;  margin: 0;}@media (max-width: 768px) {  #section-selection .header h1 {    font-size: 2.4em;  }  #section-selection .header p {    font-size: 1.1em;  }}.header-content {  display: flex;  align-items: center;  justify-content: space-between;  flex-wrap: wrap;}.header-title-container {  flex: 1;  text-align: center;}.header-content h1 {  color: var(--accent-0);  margin: 0;  font-size: 2em;}/* Keyboard Navigation Focus Styles */html {  scroll-behavior: smooth;}body.keyboard-mode {  overflow: hidden;}/* Keyboard Focus Styles */.keyboard-mode .keyboard-focused {  outline: 2px solid rgba(var(--accent-0-rgb), 0.8) !important;  background-color: rgba(var(--accent-0-rgb), 0.2) !important;  box-shadow:    0 0 5px rgba(var(--accent-0-rgb), 0.6),    0 0 15px rgba(var(--accent-6-rgb), 0.4) !important;    color: #ffffff !important;  text-shadow: 0 0 3px rgba(var(--accent-0-rgb), 0.7) !important;  transform: scale(1.02);  transition:    transform 0.2s ease,    box-shadow 0.3s ease,    background-color 0.3s ease;    position: relative;  z-index: 2;}/* Luck popup specific focus */.luck-result .keyboard-focused {  background-color: rgba(255, 0, 255, 0.2) !important;  box-shadow:    0 0 5px rgba(255, 0, 255, 0.6),    0 0 15px rgba(200, 0, 200, 0.4) !important;  color: #ffffff !important;}/* Section card specific focus */.section-card.keyboard-focused {  transform: scale(1.05);  z-index: 10;  box-shadow:    0 0 10px rgba(var(--accent-0-rgb), 0.8),    0 0 20px rgba(var(--accent-7-rgb), 0.6);}button:focus,.section-card:focus,.answer-wrapper:focus {  outline: none !important;}/* Update your focus styles */.keyboard-mode button:focus,.keyboard-mode .answer-wrapper:focus,.keyboard-mode .section-card:focus {  animation: keyboard-focus-pulse 1.5s infinite;  outline: none !important;  background-color: rgba(var(--accent-0-rgb), 0.15);  box-shadow: 0 0 10px rgba(var(--accent-0-rgb), 0.6);}/* Update the pulsation animation */@keyframes keyboard-focus-pulse {  0%, 100% {    box-shadow: 0 0 0 2px rgba(var(--accent-0-rgb), 0.7),                0 0 10px rgba(var(--accent-0-rgb), 0.6);    background-color: rgba(var(--accent-0-rgb), 0.15);  }  50% {    box-shadow: 0 0 0 3px rgba(var(--accent-0-rgb), 0.4),                0 0 15px rgba(var(--accent-0-rgb), 0.8);    background-color: rgba(var(--accent-0-rgb), 0.25);  }}/* Score/timer and button styles */.score-timer {  display: flex;  align-items: center;  gap: 15px;}.score-timer-info {  text-align: right;}#scoreBoard, #timer {  font-size: 1.2em;  font-weight: bold;  color: var(--accent-0);}/* Section card styles */.section-card {  cursor: pointer;  user-select: none;  border: 2px solid var(--accent-0);  padding: 15px;  border-radius: 8px;  margin: 10px;  background-color: #1a1a1a;  color: #ccc;  transition: transform 0.6s ease;  transform-style: preserve-3d;  flex: 1 1 200px;  max-width: 200px;  text-align: center;}.section-card:hover {  transform: scale(1.05);}.section-card.colorize {  animation: colorizeAnimation 0.6s forwards;  background: var(--accent-0);}.reset-flash {  animation: flash 0.3s;}@keyframes flash {  0% { opacity: 1; }  50% { opacity: 0.3; }  100% { opacity: 1; }}@keyframes colorizeAnimation {  from {    background-color: #1a1a1a;    color: #ccc;  }  to {    background-color: var(--accent-0);    color: #0d0d0d;  }}.section-card.decolorize {  animation: decolorizeAnimation 0.6s forwards;  background: #1a1a1a;}@keyframes decolorizeAnimation {  from {    background-color: var(--accent-0);    color: #0d0d0d;  }  to {    background-color: #1a1a1a;    color: #ccc;  }}/* New header rule to center title and paragraph */.header {  text-align: center;}/* Inner content for the flipping effect */.section-card .card-inner {  position: relative;  width: 100%;  height: 100%;  text-align: center;  transition: transform 0.6s;  transform-style: preserve-3d;}/* Optional: if you want to add a back side */.section-card .card-back {  position: absolute;  top: 0;  left: 0;  width: 100%;  height: 100%;  background-color: var(--accent-0);  color: #0d0d0d;  border-radius: 8px;  transform: rotateY(180deg);  display: flex;  align-items: center;  justify-content: center;  font-weight: bold;}.section-card .card-inner h2 {  color: var(--accent-0);}/* Section container remains centered */.section-container {  display: flex;  gap: 20px;  justify-content: center;  flex-wrap: wrap;  margin-top: 40px;  text-align: center;}/* Progress bar with neon accent */.progress-container {  border: 2px solid var(--accent-0);  border-radius: 8px;  background: transparent;  padding: 2px;  box-shadow: 0 0 10px rgba(var(--accent-0-rgb), 0.5);}#try-my-luck {  background-color: #c300c3;  color: #f0e0f0;  border: none;  padding: 10px 20px;  border-radius: 10px;  cursor: pointer;  margin-left: 10px;  font-weight: bold;  transition: all 0.3s ease;  box-shadow: 0 0 12px rgba(195, 0, 195, 0.6);}#try-my-luck:hover {  background-color: #a500a5;  box-shadow: 0 0 18px rgba(165, 0, 165, 0.8);}#try-my-luck:active {  transform: scale(0.97);  box-shadow: 0 0 8px rgba(195, 0, 195, 0.4);}.luck-result {  position: fixed;  top: 50%;  left: 50%;  transform: translate(-50%, -50%);  background: rgba(0, 0, 0, 0.9);  color: var(--accent-0);  border: 2px solid #ff00ff;  border-radius: 10px;  padding: 20px;  max-width: 400px;  z-index: 1000;  text-align: center;  box-shadow: 0 0 20px rgba(255, 0, 255, 0.7);}.luck-result h2 {  color: #ff00ff;  margin-top: 0;}.luck-result button {  margin-top: 15px;  background-color: #ff00ff;  color: #0d0d0d;}.progress-bar {  height: 20px;  border-radius: 6px;  background: linear-gradient(90deg, var(--accent-0), var(--accent-1), var(--accent-2));  transition: width 0.5s ease-out;}/* Reward animations for the scoreboard */@keyframes rewardAnimation {  0% { transform: scale(1); }  50% { transform: scale(1.2); }  100% { transform: scale(1); }}/* Update quiz container background */.quiz-container {  background-color: #1a1a1a;  padding: 20px;  border-radius: 16px;  max-width: 900px;  margin: 20px auto;  box-shadow: 0 0 20px rgba(var(--accent-0-rgb), 0.5);}/* Buttons *//* Question container */.question {  position: relative;  padding: 20px;  margin-bottom: 20px;  background-color: #111;  border-radius: 8px;  border-left: 4px solid var(--accent-0);}.question p:first-child {  font-size: 1.1em;  margin-bottom: 15px;  color: #e0e0e0;}/* Drag & Drop Styling */.question {  transition: all 0.25s ease;}.question.dragging {  opacity: 0.4;  transform: scale(0.98);  box-shadow: 0 0 20px rgba(var(--accent-0-rgb), 0.6);}.question.drag-over {  border: 2px dashed var(--accent-0);  background: rgba(var(--accent-0-rgb), 0.1);}/* Answer container */.answer-container {  position: relative;  margin-bottom: 10px;}.answer-container .status-icon {  position: absolute;  right: 15px;  top: 50%;  transform: translateY(-50%);  font-size: 26px;  font-weight: bold;  opacity: 1;}/* Status icons */.answer-container .status-icon.correct {  color: var(--accent-2);  text-shadow:  0 0 5px var(--accent-0),  0 0 15px var(--accent-0),  0 0 25px rgba(var(--accent-0-rgb), 0.6);  animation: correct-glow-pulse 2s infinite ease-in-out;}@keyframes correct-glow-pulse {  0%, 100% { text-shadow: 0 0 6px rgba(var(--accent-2-rgb), 0.7); }  50% { text-shadow: 0 0 12px rgba(var(--accent-0-rgb), 0.9); }}.answer-container .status-icon.incorrect {  color: var(--accent-4);  text-shadow:    0 0 4px rgba(var(--accent-4-rgb), 0.7),    0 0 10px rgba(var(--accent-3-rgb), 0.4),    0 0 16px rgba(var(--accent-2-rgb), 0.2);  animation: wrong-glow-pulse 2.8s infinite ease-in-out;}@keyframes wrong-glow-pulse {  0%, 100% {    text-shadow:      0 0 4px rgba(var(--accent-4-rgb), 0.7),      0 0 8px rgba(var(--accent-3-rgb), 0.4),      0 0 14px rgba(var(--accent-2-rgb), 0.2);  }  50% {    text-shadow:      0 0 6px rgba(var(--accent-3-rgb), 0.9),      0 0 12px rgba(var(--accent-2-rgb), 0.6),      0 0 20px rgba(var(--accent-0-rgb), 0.3);  }}/* Question buttons */.question button {  background-color: #222;  border: 1px solid var(--accent-0);  padding: 12px 18px;  margin: 0 0 12px 0;  border-radius: 8px;  color: #ccc;  font-weight: normal;  cursor: pointer;  transition: background-color 0.3s ease, color 0.3s ease, box-shadow 0.3s ease;  display: block;  width: 100%;  text-align: left;  box-sizing: border-box;}.question:not([data-answered="true"]) button:hover {  background-color: var(--accent-5);  color: var(--accent-0);  box-shadow: 0 0 12px rgba(var(--accent-0-rgb), 0.6);}.question[data-answered="true"] button {  cursor: default;  pointer-events: none;}.question[data-answered="true"] button:hover {  background-color: inherit;  color: inherit;  box-shadow: none;  transition: none;}.question button.correct {  background-color: rgba(var(--accent-2-rgb), 0.65);  border-color: var(--accent-1);  color: var(--accent-0);  box-shadow: 0 0 12px rgba(var(--accent-1-rgb), 0.7);  animation: correct-button-glow 2.2s infinite ease-in-out;}@keyframes correct-button-glow {  0%, 100% {    box-shadow:      0 0 8px rgba(var(--accent-2-rgb), 0.6),      0 0 16px rgba(var(--accent-0-rgb), 0.4),      inset 0 0 6px rgba(var(--accent-0-rgb), 0.3);  }  50% {    box-shadow:      0 0 14px rgba(var(--accent-0-rgb), 0.9),      0 0 28px rgba(var(--accent-0-rgb), 0.7),      inset 0 0 10px rgba(var(--accent-0-rgb), 0.5);  }}.question button.incorrect {  background-color: rgba(var(--accent-5-rgb), 0.78);  border-color: var(--accent-4);  color: var(--accent-2);  box-shadow: inset 0 0 8px rgba(var(--accent-4-rgb), 0.45);  filter: brightness(0.95) contrast(1.1);}.question button.dimmed {  opacity: 0.48;  filter: brightness(0.88) saturate(0.75);  transition: opacity 0.7s ease, filter 0.75s ease;}/* Explanation */.explanation {  font-size: 0.9em;  color: #b0b0b0;  margin-top: 8px;  padding-left: 10px;  border-left: 2px solid #555;}/* Answer popup – completely disabled */.answer-popup {  display: none !important;}/* Dashed style */.dashed-answer {  color: #ffaaaa;  border: 2px dashed #ff0000;  padding: 4px;  display: inline-block;}@keyframes fadeIn {  from { opacity: 0; transform: scale(0.95) translateY(10px); }  to { opacity: 1; transform: scale(1) translateY(0); }}/* Edit Mode */.question.edit-mode {  position: relative;  border: 2px dashed var(--accent-0);  padding-top: 45px;}.question-edit-toolbar {  position: absolute;  top: 8px;  right: 8px;  display: flex;  gap: 6px;  z-index: 10;}.question-edit-toolbar button {  background-color: #333;  color: var(--accent-0);  border: 1px solid var(--accent-0);  padding: 4px 10px;  border-radius: 6px;  font-size: 0.85em;  cursor: pointer;}.question-edit-toolbar button:hover {  background-color: var(--accent-0);  color: #0d0d0d;}.question.edit-mode p,.question.edit-mode .explanation,.question.edit-mode button span {  outline: 1px dashed var(--accent-0);  background: rgba(var(--accent-0-rgb), 0.08);  padding: 4px 8px;  border-radius: 4px;}/* Back to Sections button */#back-to-sections {  background-color: var(--accent-0);  color: #0d0d0d;  border: none;  padding: 10px 20px;  border-radius: 10px;  cursor: pointer;  margin-right: 20px;}body.section4-active #try-my-luck {  display: none;}/* Restart button */#restart {  background-color: var(--accent-0);  color: #0d0d0d;  border: none;  padding: 10px 20px;  border-radius: 10px;  cursor: pointer;  display: block;  margin: 20px auto;}/* Edit Mode Toggle Button */#toggle-edit-btn {  background-color: var(--accent-0);  color: #0d0d0d;  border: none;  padding: 10px 20px;  border-radius: 10px;  cursor: pointer;  font-weight: bold;  transition: all 0.3s ease;  margin-left: 10px;}#toggle-edit-btn:hover {  background-color: var(--accent-2);  box-shadow: 0 0 12px rgba(var(--accent-0-rgb), 0.6);}#toggle-edit-btn.active {  background-color: #ff4444;  color: #ffffff;  box-shadow: 0 0 12px rgba(255, 68, 68, 0.6);}/* Revert Changes Button */#revert-changes-btn {  background-color: #ff4444;  color: #ffffff;  border: none;  padding: 10px 18px;  border-radius: 10px;  cursor: pointer;  font-weight: bold;  transition: all 0.3s ease;  margin-left: 10px;  display: none;  opacity: 1;}body.edit-mode #revert-changes-btn {  display: inline-block;}body.edit-mode #revert-changes-btn.no-changes,#revert-changes-btn.no-changes {  opacity: 0.55 !important;  background-color: #444444 !important;  color: #aaaaaa !important;  border: 3px dashed #ff4444 !important;  cursor: not-allowed !important;  pointer-events: none !important;  filter: grayscale(0.5);  box-shadow: none !important;}body.edit-mode #revert-changes-btn:not(.no-changes) {  opacity: 1 !important;  background-color: #ff4444 !important;  color: #ffffff !important;  border: none !important;  cursor: pointer !important;  pointer-events: auto !important;  filter: none !important;}#revert-changes-btn:hover:not(.no-changes) {  background-color: #cc2222;  box-shadow: 0 0 12px rgba(255, 68, 68, 0.6);}/* Page Title & Section Title Editing Buttons */#change-page-title-btn {  background-color: #00bcd4;  color: #ffffff;  border: none;  padding: 10px 18px;  border-radius: 10px;  cursor: pointer;  font-weight: bold;  margin-left: 10px;  display: none;}#change-page-title-btn:hover {  background-color: #0097a7;}body.edit-mode #change-page-title-btn {  display: inline-block;}/* Export / Import Buttons */.export-import-group {  display: none;  gap: 10px;  margin-left: 10px;}body.edit-mode .export-import-group {  display: flex;}.export-import-group button {  background-color: #00bcd4;  color: #ffffff;  border: none;  padding: 10px 18px;  border-radius: 10px;  cursor: pointer;  font-weight: bold;  transition: all 0.3s ease;}.export-import-group button:hover {  background-color: #0097a7;  box-shadow: 0 0 12px rgba(0, 188, 212, 0.6);}/* New CSS for answer toggling */.answer-wrapper {  position: relative;  transition: all 0.3s ease;  cursor: pointer;}.answer-wrapper.blurred::after {  content: "";  position: absolute;  top: 0;  left: 0;  width: 100%;  height: 100%;  background: linear-gradient(45deg, rgba(var(--accent-0-rgb), 0.5), rgba(var(--accent-2-rgb), 0.4), rgba(var(--accent-4-rgb), 0.5));  background-size: 300% 300%;  animation: gradientAnimation 6s ease infinite;  backdrop-filter: blur(5px);  pointer-events: none;  box-shadow: 0 0 10px rgba(var(--accent-0-rgb), 0.5), 0 0 20px rgba(var(--accent-0-rgb), 0.4);}@keyframes gradientAnimation {  0% { background-position: 0% 0%; }  25% { background-position: 100% 0%; }  50% { background-position: 100% 100%; }  75% { background-position: 0% 100%; }  100% { background-position: 0% 0%; }}button.neon-animate {  animation: neonFlash 0.2s ease-out;}@keyframes neonFlash {  0% {    box-shadow: 0 0 0px var(--accent-0);    transform: scale(1);  }  50% {    box-shadow: 0 0 15px var(--accent-0), 0 0 30px var(--accent-0);    transform: scale(1.02);  }  100% {    box-shadow: 0 0 0px var(--accent-0);    transform: scale(1);  }}/* ==================== EDIT MODE TIMER & TRY MY LUCK STYLING ==================== */body.edit-mode #timer {  color: #666 !important;  text-shadow: none;}#try-my-luck.luck-used {  opacity: 0.55 !important;  background-color: #333 !important;  color: #888 !important;  border: 3px dashed #ff00ff !important;  box-shadow: none !important;  cursor: default !important;}body.edit-mode #try-my-luck {  opacity: 0.55 !important;  background-color: #333 !important;  color: #888 !important;  border: 3px dashed #ff00ff !important;  box-shadow: none !important;  cursor: not-allowed !important;  pointer-events: none !important;}body.edit-mode #try-my-luck:hover,#try-my-luck.luck-used:hover {  transform: none !important;  box-shadow: none !important;}/* Revert Changes button */#revert-changes-btn {  background-color: #ff4444;  color: #ffffff;  border: none;  padding: 10px 18px;  border-radius: 10px;  cursor: pointer;  font-weight: bold;  transition: all 0.3s ease;  margin-left: 10px;  display: none;}body.edit-mode #revert-changes-btn {  display: inline-block;}body.edit-mode #revert-changes-btn.no-changes,#revert-changes-btn.no-changes {  opacity: 0.55 !important;  background-color: #444 !important;  color: #aaa !important;  border: 3px dashed #ff4444 !important;  cursor: not-allowed !important;  pointer-events: none !important;  filter: grayscale(0.5);}#revert-changes-btn:hover:not(.no-changes) {  background-color: #cc2222;  box-shadow: 0 0 12px rgba(255, 68, 68, 0.6);}/* Floating Save Button */#floating-save-btn {  position: fixed;  bottom: 25px;  right: 25px;  z-index: 10000;  background-color: #00ff88;  color: #0d0d0d;  border: none;  padding: 14px 24px;  border-radius: 50px;  font-weight: bold;  font-size: 1.05em;  cursor: pointer;  box-shadow: 0 4px 20px rgba(0, 255, 136, 0.5);  transition: all 0.3s ease;  animation: pulse-save 2s infinite;  display: none !important;}#floating-save-btn:hover {  transform: scale(1.08);  box-shadow: 0 6px 25px rgba(0, 255, 136, 0.7);}body.edit-mode #floating-save-btn {  display: block !important;}@keyframes pulse-save {  0%, 100% { box-shadow: 0 4px 20px rgba(0, 255, 136, 0.5); }  50% { box-shadow: 0 4px 30px rgba(0, 255, 136, 0.9); }}/* Green Success Feedback */#save-success {  position: fixed;  top: 20px;  left: 50%;  transform: translateX(-50%);  background-color: #00cc66;  color: #ffffff;  padding: 12px 30px;  border-radius: 50px;  font-weight: bold;  box-shadow: 0 4px 20px rgba(0, 204, 102, 0.6);  z-index: 10001;  display: none;  animation: fadeOut 3s forwards;}@keyframes fadeOut {  0% { opacity: 1; }  80% { opacity: 1; }  100% { opacity: 0; }}#playlist-title-container {  overflow: hidden;  flex: 1;  min-width: 0;  position: relative;}#suno-playlist-widget {  position: fixed; left: 22px; top: 92px; width: 358px;  background: rgba(26,26,26,0.97); border: 3px solid var(--accent-0);  border-radius: 18px; box-shadow: 0 0 50px rgba(var(--accent-0-rgb), 0.8);  z-index: 998; overflow: hidden; transition: all 0.4s ease; backdrop-filter: blur(12px);}/* COLLAPSED STATE - ONLY HIDES PLAYER + SONG LIST */#suno-playlist-widget.collapsed #suno-player-area,#suno-playlist-widget.collapsed #suno-song-list {  display: none !important;}#suno-playlist-widget.collapsed {  height: auto !important;  min-height: 115px !important;}/* HEADER = TWO ROWS */#suno-playlist-header {  display: flex !important;  flex-direction: column !important;  padding: 0 !important;  background: rgba(26,26,26,0.97);  border-bottom: none;  cursor: default;}.header-top {  display: flex;  align-items: center;  gap: 14px;  padding: 14px 18px 8px;  background: linear-gradient(90deg,#0f0f0f,#1a1a1a);  border-bottom: 1px solid rgba(var(--accent-0-rgb), 0.2);  cursor: pointer;}/* CLEAN CONTROL BAR - NO SEEK BAR */#suno-control-bar {  display: flex !important;  align-items: center;  gap: 8px;  padding: 12px 16px;  border-top: 1px solid rgba(var(--accent-0-rgb), 0.15);  background: rgba(13,13,13,0.95);}.suno-btn {  width:42px; height:42px; border-radius:50%; background:rgba(0,255,255,0.08); border:2px solid var(--accent-0);  color:var(--accent-0); font-size:20px; display:flex; align-items:center; justify-content:center; transition:all .2s; flex-shrink:0;}.suno-btn:hover { background:var(--accent-0); color:#0d0d0d; transform:scale(1.1); box-shadow:0 0 18px rgba(0,255,255,0.6); }.main-btn { width:56px!important; height:56px!important; font-size:26px!important; background:var(--accent-0)!important; color:#111!important; border:none!important; }/* Remaining original styles */#suno-playlist-info { margin-left:14px; flex:1; min-width:0; }#suno-playlist-info h3 { margin:0; font-size:1.25em; color:var(--accent-0); white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }#suno-playlist-info p { margin:3px 0 0; font-size:0.82em; color:#888; }#suno-toggle-btn { background:none; border:none; color:var(--accent-0); font-size:26px; width:36px; height:36px; display:flex; align-items:center; justify-content:center; border-radius:50%; transition:0.3s; }#suno-playlist-widget:not(.collapsed) #suno-toggle-btn { transform:rotate(180deg); }#suno-song-list { max-height:0; overflow:hidden; transition:max-height .45s ease; background:#0a0a0a; }#suno-song-list.open { max-height:520px; }.song-row { display:flex; align-items:center; padding:11px 16px; cursor:pointer; transition:.2s; }.song-row:hover, .song-row.active { background:rgba(var(--accent-0-rgb), 0.15); }.song-row.selected { background:rgba(var(--accent-0-rgb),0.3)!important; border-left:4px solid var(--accent-0)!important; font-weight:bold; }.song-row img { width:48px!important; height:48px!important; border-radius:8px; object-fit:cover; margin-right:12px; flex-shrink:0; }.song-row .info { flex:1 1 auto; min-width:0; max-width:calc(100% - 72px); }.song-row .title { font-size:0.96em; color:#eee; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }.song-row .duration { font-size:0.82em; color:var(--accent-0); margin-top:2px; }</style></head><body><!-- ==================== CLEAN DYNAMIC SUNO PLAYLIST WIDGET ==================== --><div id="suno-playlist-widget" tabindex="0">  <div id="suno-playlist-header">    <!-- Top row -->    <div class="header-top">      <div id="playlist-cover-container" style="width:52px;height:52px;border-radius:10px;overflow:hidden;border:2px solid var(--accent-0);flex-shrink:0;">        <img id="playlist-cover" src="https://cdn2.suno.ai/80988183.jpeg?width=360" style="width:100%;height:100%;object-fit:cover;" alt="">      </div>      <div id="suno-playlist-info">        <div id="playlist-title-container" style="overflow:hidden; white-space:nowrap; flex:1; min-width:0; position:relative;">  <h3 id="playlist-title" style="display:inline-block; white-space:nowrap; margin:0; transition:transform 0s linear; will-change:transform;">    Loading playlist...  </h3></div>        <p id="playlist-meta">Suno AI • Fetching songs...</p>      </div>      <button id="suno-toggle-btn" onclick="toggleSunoWidget()">▼</button>    </div>    <div id="suno-control-bar">      <button id="prev-btn" class="suno-btn" title="Previous" onclick="prevSong(event)">⏮</button>      <button id="next-btn" class="suno-btn" title="Next" onclick="nextSong(event)">⏭</button>    </div>  </div>  <!-- PLAYER AREA -->  <div id="suno-player-area" style="position:relative;height:460px;overflow:hidden;">    <iframe id="suno-embed" width="100%" height="460" frameborder="0" allow="autoplay;encrypted-media" allowfullscreen></iframe>  </div>  <button onclick="toggleSongList()" id="songs-button" style="width:100%;padding:14px;background:#1a1a1a;border:none;color:var(--accent-0);font-weight:bold;cursor:pointer;border-top:1px solid rgba(0,255,255,0.2);">▼ Songs (<span id="song-count">0</span>)</button>  <div id="suno-song-list"></div></div>  <!-- Homepage Section Selection -->  <div id="section-selection">  <div class="header" style="position:relative;">    <h1>Radiation Protection Quiz Sections</h1>    <p>Select a section to begin your quiz</p>    <button id="settings-btn" class="settings-btn" title="Settings">⚙️</button>  </div>    <div class="section-container">  <div class="section-card" data-section="section1" tabindex="0">    <div class="card-inner">      <h2>Section 1</h2>      <p>Basic Radiation Protection</p>      <p class="section-timer">Time left: 30:00</p>      <p class="question-count">50 questions</p>      <div class="progress-container section-progress">        <div class="progress-bar" style="width: 0%;"></div>      </div>    </div>  </div>  <div class="section-card" data-section="section2" tabindex="0">    <div class="card-inner">      <h2>Section 2</h2>      <p>Radiation Physics</p>      <p class="section-timer">Time left: 30:00</p>      <p class="question-count">50 questions</p>      <div class="progress-container section-progress">        <div class="progress-bar" style="width: 0%;"></div>      </div>    </div>  </div>  <div class="section-card" data-section="section3" tabindex="0">    <div class="card-inner">      <h2>Section 3</h2>      <p>NRRC Regulations</p>      <p class="section-timer">Time left: 30:00</p>      <p class="question-count">35 questions</p>      <div class="progress-container section-progress">        <div class="progress-bar" style="width: 0%;"></div>      </div>    </div>  </div>  <div class="section-card" data-section="section4" tabindex="0">    <div class="card-inner">      <h2>Section 4</h2>      <p>Radiation Safety Scenarios</p>      <p class="section-timer">Time left: 30:00</p>      <p class="question-count">40 scenarios</p>      <div class="progress-container section-progress">        <div class="progress-bar" style="width: 0%;"></div>      </div>    </div>  </div></div>  </div>  <!-- Quiz Section (Initially Hidden) -->  <div id="quiz-section" style="display: none;">    <div class="quiz-header">     <div class="header-content">  <button id="back-to-sections" onclick="backToSections()">Back to Sections</button>  <div class="header-title-container">    <h1 id="section-title"></h1>  </div>  <div id="score-timer-container" class="score-timer">    <div class="score-timer-info">      <div id="scoreBoard">Score: <span id="correctAnswers">0</span>/<span id="totalQuestions">0</span></div>      <div id="timer"><span id="time">1800</span></div>    </div>    <button id="try-my-luck" onclick="tryMyLuck()">Try my luck!</button>    <button id="restart" onclick="restartQuiz()">Restart Quiz</button>    <button id="toggle-edit-btn" onclick="toggleEditMode()">Enable Edit Mode</button>    <button id="revert-changes-btn" onclick="revertChanges()">Revert Changes</button>    <button id="change-page-title-btn" onclick="changePageTitle()">Change Page Title</button>    <!-- NEW: Export / Import Group --><div class="export-import-group">  <button onclick="exportReadableTXT()">Export Readable TXT</button>  <button onclick="exportHTMLFormatTXT()">Export HTML Format TXT</button>  <button onclick="exportAsJSON()">Export JSON</button>  <button onclick="importTXTFile()">Import & Replace All</button></div></div></div>      <div id="progress-container" class="progress-container">        <div class="progress-bar" id="progressBar"></div>      </div>    </div>    <div class="quiz-container">      <div id="quiz"></div>    </div>  </div>  <!-- Step 5: Insert the JavaScript code -->  <script>    // --- 5a: Insert your full quiz data array here (100 questions) ---    const quizData = [      {        "question": "1. What is the process of removing an electron from an atom called?",        "options": ["Ionization", "Excitation", "Fusion", "Fission"],        "correct": "Ionization"      },      {        "question": "2. What is the SI unit for measuring radioactivity?",        "options": ["Gray (Gy)", "Sievert (Sv)", "Becquerel (Bq)", "Curie (Ci)"],        "correct": "Becquerel (Bq)"      },      {        "question": "3. Which unit measures equivalent or effective radiation dose?",        "options": ["Gray (Gy)", "Sievert (Sv)", "Becquerel (Bq)", "Curie (Ci)"],        "correct": "Sievert (Sv)"      },      {        "question": "4. Which type of radiation can be stopped by a sheet of paper?",        "options": ["Alpha particles", "Beta particles", "Gamma rays", "Neutrons"],        "correct": "Alpha particles"      },      {        "question": "5. Which type of radiation is most dangerous if inhaled or ingested?",        "options": ["Alpha particles", "Beta particles", "Gamma rays", "Neutrons"],        "correct": "Alpha particles"      },      {        "question": "6. What material best slows down fast neutrons?",        "options": ["Lead", "Concrete", "Water", "Aluminum"],        "correct": "Water"      },      {        "question": "7. What is an alpha particle?",        "options": ["A helium nucleus", "A hydrogen nucleus", "A beta particle", "A neutron"],        "correct": "A helium nucleus"      },      {        "question": "8. What are deterministic effects of radiation?",        "options": ["Effects with a threshold", "Effects that occur at any dose", "Random effects", "None of the above"],        "correct": "Effects with a threshold"      },      {        "question": "9. What is an example of a stochastic effect of radiation?",        "options": ["Cancer", "Skin burn", "Cataracts", "Acute radiation syndrome"],        "correct": "Cancer"      },      {        "question": "10. Which radiation protection principle justifies using radiation only when benefits outweigh risks?",        "options": ["Optimization", "Justification", "Dose limitation", "ALARA"],        "correct": "Justification",        "explanation": "Justification requires that any planned use of radiation is evaluated to ensure that the potential benefits outweigh the risks. It’s the first step in preventing unnecessary exposure."      },      {        "question": "11. What does ALARA stand for?",        "options": ["As Low As Reasonably Achievable", "As Long As Radiation Allows", "As Low As Radon", "None of the above"],        "correct": "As Low As Reasonably Achievable",        "explanation": "ALARA is a practical philosophy guiding the optimization of radiation protection. It means keeping exposures as low as reasonably achievable, considering economic and societal factors."      },      {        "question": "12. Which of the following is NOT one of the three fundamental principles of radiation protection?",        "options": ["Justification", "Optimization", "Dose limitation", "Shielding"],        "correct": "Shielding"      },      {        "question": "13. What are the three main ways to reduce external radiation exposure?",        "options": ["Time, Distance, Shielding", "Distance, Shielding, Ventilation", "Time, Shielding, Absorption", "Distance, Absorption, Reflection"],        "correct": "Time, Distance, Shielding"      },      {        "question": "14. How often should personal dosimeters typically be changed?",        "options": ["Monthly", "Quarterly", "Every two weeks", "Annually"],        "correct": "Quarterly"      },      {        "question": "15. What is the maximum dose limit to the fetus after a pregnant worker declares pregnancy?",        "options": ["1 mSv for the remainder of the pregnancy", "5 mSv", "10 mSv", "20 mSv"],        "correct": "1 mSv for the remainder of the pregnancy"      },      {        "question": "16. What is the occupational dose limit for radiation workers per year?",        "options": ["5 mSv", "10 mSv", "20 mSv", "50 mSv"],        "correct": "20 mSv"      },      {        "question": "17. What is the public dose limit per year?",        "options": ["0.5 mSv", "1 mSv", "5 mSv", "10 mSv"],        "correct": "1 mSv"      },      {        "question": "18. What is the annual dose limit for the lens of the eye for radiation workers?",        "options": ["5 mSv", "15 mSv", "20 mSv", "50 mSv"],        "correct": "20 mSv"      },      {        "question": "19. What is the equivalent dose limit for skin or extremities?",        "options": ["50 mSv", "150 mSv", "500 mSv", "1000 mSv"],        "correct": "500 mSv"      },      {        "question": "20. If the activity of a radioactive sample drops to one-fourth in 10 hours, what is its half-life?",        "options": ["2.5 hours", "5 hours", "10 hours", "20 hours"],        "correct": "5 hours"      },      {        "question": "21. What is the SI unit for absorbed dose?",        "options": ["Gray (Gy)", "Sievert (Sv)", "Becquerel (Bq)", "Curie (Ci)"],        "correct": "Gray (Gy)"      },      {        "question": "22. What is the SI unit for equivalent and effective dose?",        "options": ["Gray (Gy)", "Sievert (Sv)", "Becquerel (Bq)", "Curie (Ci)"],        "correct": "Sievert (Sv)"      },      {        "question": "23. Which instrument is commonly used for real-time field detection of radiation by counting ionizing events?",        "options": ["Geiger-Müller counter", "Thermoluminescent dosimeter", "Ionization chamber", "Scintillation counter"],        "correct": "Geiger-Müller counter"      },      {        "question": "24. Which instrument is commonly used for individual dose monitoring?",        "options": ["Film badge", "TLD", "Pocket dosimeter", "All of the above"],        "correct": "All of the above"      },      {        "question": "25. What does 'committed effective dose' refer to?",        "options": ["Dose from external exposure", "Dose from a one-time exposure", "Lifetime dose from an intake", "Instantaneous dose rate"],        "correct": "Lifetime dose from an intake"      },      {        "question": "26. What is the purpose of dose constraints in radiation protection?",        "options": ["To limit emergency doses", "To set prospective dose limits for optimization", "To measure environmental dose", "To calibrate instruments"],        "correct": "To set prospective dose limits for optimization"      },      {        "question": "27. Which of the following is a measure of radioactivity?",        "options": ["Absorbed dose", "Activity", "Dose rate", "Exposure time"],        "correct": "Activity"      },      {        "question": "28. What is the relation between Curie and Becquerel?",        "options": ["1 Ci = 3.7 x 10^10 Bq", "1 Ci = 3.7 x 10^8 Bq", "1 Ci = 3.7 x 10^12 Bq", "1 Ci = 3.7 x 10^6 Bq"],        "correct": "1 Ci = 3.7 x 10^10 Bq"      },      {        "question": "29. Which type of radiation is most penetrating?",        "options": ["Alpha", "Beta", "Gamma", "Neutron"],        "correct": "Gamma"      },      {        "question": "30. What is the primary purpose of a radiation survey meter?",        "options": ["To measure temperature", "To measure external radiation dose rates", "To detect chemical spills", "To monitor heart rate"],        "correct": "To measure external radiation dose rates"      },      {        "question": "31. What does a personal dosimeter measure?",        "options": ["The cumulative radiation dose received", "The instantaneous radiation dose rate", "The radioactivity of materials", "None of the above"],        "correct": "The cumulative radiation dose received"      },      {        "question": "32. Which of the following is a deterministic effect of radiation?",        "options": ["Cancer", "Genetic mutation", "Skin burns", "Leukemia"],        "correct": "Skin burns"      },      {        "question": "33. Which of the following is a stochastic effect of radiation?",        "options": ["Cataracts", "Skin erythema", "Cancer", "Radiation burns"],        "correct": "Cancer"      },      {        "question": "34. Which organization sets international radiation safety standards?",        "options": ["IAEA", "WHO", "FDA", "EPA"],        "correct": "IAEA"      },      {        "question": "35. What is the primary purpose of radiological emergency planning?",        "options": ["To prepare for potential radiation accidents", "To schedule maintenance", "To improve fuel efficiency", "To manage administrative tasks"],        "correct": "To prepare for potential radiation accidents"      },      {        "question": "36. Which material is commonly used for gamma shielding?",        "options": ["Lead", "Aluminum", "Wood", "Water"],        "correct": "Lead"      },      {        "question": "37. Which material is effective for neutron shielding?",        "options": ["Concrete", "Lead", "Water", "Plastic"],        "correct": "Water"      },      {        "question": "38. What does 'clearance' mean in radiation protection?",        "options": ["Removing control from a radioactive material because its dose is too low", "Increasing radiation exposure", "Building a barrier", "None of the above"],        "correct": "Removing control from a radioactive material because its dose is too low"      },      {        "question": "39. What is a sealed source?",        "options": ["A radioactive source encapsulated to prevent leakage", "A source used only in sealed containers", "A source with zero activity", "A non-radioactive source"],        "correct": "A radioactive source encapsulated to prevent leakage"      },      {        "question": "40. Which of the following is NOT a type of radioactive decay?",        "options": ["Alpha decay", "Beta decay", "Gamma decay", "Neutron decay"],        "correct": "Neutron decay"      },      {        "question": "41. What is beta-negative decay?",        "options": ["A neutron decays into a proton with emission of an electron and antineutrino", "A proton decays into a neutron with emission of a positron", "A nucleus emits an alpha particle", "None of the above"],        "correct": "A neutron decays into a proton with emission of an electron and antineutrino"      },      {        "question": "42. What is beta-positive decay?",        "options": ["A neutron decays into a proton with emission of an electron", "A proton decays into a neutron with emission of a positron and neutrino", "A nucleus emits an alpha particle", "A nucleus captures an electron"],        "correct": "A proton decays into a neutron with emission of a positron and neutrino"      },      {        "question": "43. What is electron capture?",        "options": ["A process where an electron is captured by the nucleus converting a proton into a neutron", "A process where an electron is emitted", "A process where an alpha particle is emitted", "A process where a beta particle is absorbed"],        "correct": "A process where an electron is captured by the nucleus converting a proton into a neutron"      },      {        "question": "44. What does gamma spectrometry measure?",        "options": ["The energy of gamma photons", "The number of alpha particles", "The half-life of a radionuclide", "The temperature of a source"],        "correct": "The energy of gamma photons"      },      {        "question": "45. What is a typical calibration frequency for radiation detection instruments?",        "options": ["Daily", "Weekly", "Annually", "Every 5 years"],        "correct": "Annually"      },      {        "question": "46. What is the primary purpose of individual monitoring in radiation protection?",        "options": ["To assess environmental contamination", "To record personal radiation dose", "To monitor chemical exposure", "To check for noise levels"],        "correct": "To record personal radiation dose"      },      {        "question": "47. What is the concept of 'optimization' in radiation protection?",        "options": ["Minimizing doses while achieving necessary outcomes", "Maximizing production", "Ignoring low doses", "None of the above"],        "correct": "Minimizing doses while achieving necessary outcomes"      },      {        "question": "48. Which radiation protection principle requires evaluating whether the benefits of using radiation outweigh the risks before proceeding?",        "options": ["Justification", "Optimization", "Dose limitation", "ALARA"],        "correct": "Justification",        "explanation": "Justification is the process of determining that a radiation practice is overall beneficial. Before any radiation is used, the risks must be weighed against the potential benefits, ensuring that the practice is necessary and justified."      },      {        "question": "49. What does 'ICRU' stand for?",        "options": ["International Commission on Radiological Units", "International Committee on Radiation Usage", "International Commission on Rationing Utilities", "International Council on Radiological Understanding"],        "correct": "International Commission on Radiological Units"      },      {        "question": "50. What is a hot spot in radiation terms?",        "options": ["A localized area with elevated radiation levels", "A term for high temperature", "A type of radioactive material", "A radiation accident"],        "correct": "A localized area with elevated radiation levels"      },      {        "question": "51. Which of the following is a benefit of remote handling tools in radiation protection?",        "options": ["Reducing worker exposure", "Increasing radiation levels", "Enhancing image quality", "Lowering equipment costs"],        "correct": "Reducing worker exposure"      },      {        "question": "52. What does the term 'specific activity' mean?",        "options": ["Activity per unit mass", "Total activity", "Activity per unit volume", "Activity per unit area"],        "correct": "Activity per unit mass"      },      {        "question": "53. Which radiation effect is characterized by a threshold dose?",        "options": ["Deterministic effects", "Stochastic effects", "Both", "Neither"],        "correct": "Deterministic effects"      },      {        "question": "54. Which radiation effect is probabilistic in nature?",        "options": ["Deterministic effects", "Stochastic effects", "Both", "Neither"],        "correct": "Stochastic effects"      },      {        "question": "55. What does the term 'dose rate' refer to?",        "options": ["Dose per unit time", "Total dose", "Energy absorbed", "Dose per unit mass"],        "correct": "Dose per unit time"      },      {        "question": "56. Which of the following is a common beta particle shielding material?",        "options": ["Plastic", "Lead", "Glass", "Concrete"],        "correct": "Plastic"      },      {        "question": "57. What does a scintillation counter detect?",        "options": ["Light from radioactive decays", "Magnetic fields", "Sound waves", "Heat"],        "correct": "Light from radioactive decays"      },      {        "question": "58. What is the primary difference between absorbed dose and equivalent dose?",        "options": ["Absorbed dose does not account for radiation type, equivalent dose does", "They are the same", "Equivalent dose is always higher", "None of the above"],        "correct": "Absorbed dose does not account for radiation type, equivalent dose does"      },      {        "question": "59. What does 'quality assurance' refer to in medical radiological procedures?",        "options": ["Ensuring optimal image quality and safety", "Ensuring proper waste disposal", "Scheduling patient appointments", "None of the above"],        "correct": "Ensuring optimal image quality and safety"      },      {        "question": "60. What is the role of a Radiation Protection Officer (RPO)?",        "options": ["To oversee radiation safety programs", "To operate machinery", "To conduct administrative tasks", "To manage finances"],        "correct": "To oversee radiation safety programs"      },      {        "question": "61. What is the concept of 'radiation weighting factor'?",        "options": ["A factor used to adjust the absorbed dose based on radiation type", "A measure of energy", "A constant value for all radiations", "None of the above"],        "correct": "A factor used to adjust the absorbed dose based on radiation type"      },      {        "question": "62. What is the purpose of regulatory inspections in radiation protection?",        "options": ["To ensure compliance with safety standards", "To repair equipment", "To increase production", "To train new employees"],        "correct": "To ensure compliance with safety standards"      },      {        "question": "63. What is the significance of the half-life of a radionuclide?",        "options": ["It indicates the time required for the activity to decrease by half", "It measures energy emission", "It is irrelevant", "It indicates the decay rate per minute"],        "correct": "It indicates the time required for the activity to decrease by half"      },      {        "question": "64. What does 'environmental monitoring' involve in radiation protection?",        "options": ["Measuring radiation levels in the environment", "Sampling air and water only", "Measuring noise levels", "None of the above"],        "correct": "Measuring radiation levels in the environment"      },      {        "question": "65. What does the acronym ICRP stand for?",        "options": ["International Commission on Radiological Protection", "International Council on Radiation Physics", "International Committee on Radiological Procedures", "None of the above"],        "correct": "International Commission on Radiological Protection"      },      {        "question": "66. Which of the following is a common method to reduce radiation exposure?",        "options": ["Increasing time", "Increasing distance", "Increasing shielding", "All of the above"],        "correct": "All of the above"      },      {        "question": "67. What is the purpose of a radiation survey report?",        "options": ["To document measured dose rates", "To record temperature", "To schedule maintenance", "To manage finances"],        "correct": "To document measured dose rates"      },      {        "question": "68. What is a typical effect of acute high-dose radiation exposure?",        "options": ["Nausea, hair loss, and fatigue", "Increased muscle strength", "Improved immune response", "None of the above"],        "correct": "Nausea, hair loss, and fatigue"      },      {        "question": "69. Which of the following best describes the concept of 'optimization of protection'?",        "options": ["Minimizing exposures while achieving necessary outcomes", "Maximizing exposures for effectiveness", "Ignoring low doses", "None of the above"],        "correct": "Minimizing exposures while achieving necessary outcomes"      },      {        "question": "70. What is the definition of ionizing radiation?",        "options": ["Radiation with enough energy to remove tightly bound electrons from atoms", "Radiation that heats objects", "Radiation that is visible", "None of the above"],        "correct": "Radiation with enough energy to remove tightly bound electrons from atoms"      },      {        "question": "71. What is a common example of natural background radiation?",        "options": ["Cosmic rays", "Medical X-rays", "Nuclear reactor emissions", "None of the above"],        "correct": "Cosmic rays"      },      {        "question": "72. What is the purpose of using a personal dosimeter?",        "options": ["To monitor individual radiation exposure", "To measure blood pressure", "To detect radioactivity in food", "None of the above"],        "correct": "To monitor individual radiation exposure"      },      {        "question": "73. What is the difference between a radioactive source and a sample?",        "options": ["A source is a controlled item with known activity; a sample may be environmental", "Both are the same", "A sample is always larger than a source", "None of the above"],        "correct": "A source is a controlled item with known activity; a sample may be environmental"      },      {        "question": "74. What is meant by 'dose assessment'?",        "options": ["The process of estimating the radiation dose received", "The process of calibrating instruments", "The process of designing shielding", "None of the above"],        "correct": "The process of estimating the radiation dose received"      },      {        "question": "75. What is the purpose of using tamper-evident seals on radioactive packages?",        "options": ["To detect unauthorized access or tampering", "To increase weight", "To reduce cost", "To improve aesthetics"],        "correct": "To detect unauthorized access or tampering"      },      {        "question": "76. What does 'leak-tightness' refer to in radioactive source containers?",        "options": ["Their ability to prevent the escape of radioactive material", "Their ability to prevent water ingress", "Their durability", "None of the above"],        "correct": "Their ability to prevent the escape of radioactive material"      },      {        "question": "77. What is the dose limit for radioactive waste workers relative to occupational limits?",        "options": ["Similar to occupational limits", "Twice the public limit", "Undefined", "None of the above"],        "correct": "Similar to occupational limits"      },      {        "question": "78. What does a 'radiation protection program' refer to?",        "options": ["A systematic approach to ensuring safety", "A marketing strategy", "A type of radiation source", "None of the above"],        "correct": "A systematic approach to ensuring safety"      },      {        "question": "79. What is the significance of the 'transport index' in radioactive material transportation?",        "options": ["It indicates the radiation level at 1 meter from the package", "It measures weight", "It calculates cost", "None of the above"],        "correct": "It indicates the radiation level at 1 meter from the package"      },      {        "question": "80. What is a common requirement for packaging radioactive materials for transport?",        "options": ["They must be leak-tight", "They must be brightly colored", "They must be transparent", "None of the above"],        "correct": "They must be leak-tight"      },      {        "question": "81. What is a common consequence of exceeding dose limits?",        "options": ["Increased risk of health effects", "Improved performance", "Enhanced immunity", "None of the above"],        "correct": "Increased risk of health effects"      },      {        "question": "82. What does 'radiological safety' in industrial practices aim to protect?",        "options": ["Workers, public, and the environment", "Only workers", "Only equipment", "None of the above"],        "correct": "Workers, public, and the environment"      },      {        "question": "83. What is meant by 'quality assurance' in radiation protection?",        "options": ["Procedures to ensure consistent safety standards", "A way to cut costs", "A method for increasing doses", "None of the above"],        "correct": "Procedures to ensure consistent safety standards"      },      {        "question": "84. What is the main difference between deterministic and stochastic effects?",        "options": ["Deterministic effects have a threshold; stochastic effects are probabilistic", "Both have thresholds", "They are identical", "None of the above"],        "correct": "Deterministic effects have a threshold; stochastic effects are probabilistic"      },      {        "question": "85. What is the purpose of dose recording and reporting?",        "options": ["To track and manage radiation exposure", "To entertain staff", "To comply with financial audits", "None of the above"],        "correct": "To track and manage radiation exposure"      },      {        "question": "86. What does 'ICRP' stand for?",        "options": ["International Commission on Radiological Protection", "International Committee on Radiation Physics", "Internal Commission on Radiation Procedures", "None of the above"],        "correct": "International Commission on Radiological Protection"      },      {        "question": "87. What is the typical unit for measuring radioactivity in the environment?",        "options": ["Becquerel per cubic meter", "Sievert per hour", "Gray per minute", "Curie per liter"],        "correct": "Becquerel per cubic meter"      },      {        "question": "88. What does 'radiation exposure' refer to?",        "options": ["The amount of radiation incident on a surface or individual", "The energy produced by a reactor", "The duration of a radiation event", "None of the above"],        "correct": "The amount of radiation incident on a surface or individual"      },      {        "question": "89. What is a common consequence of acute radiation syndrome?",        "options": ["Nausea, hair loss, and fatigue", "Increased muscle strength", "Improved immune response", "None of the above"],        "correct": "Nausea, hair loss, and fatigue"      },      {        "question": "90. What is the process of radioactive decay?",        "options": ["The spontaneous transformation of an unstable nucleus into a more stable one", "The absorption of radiation by matter", "The emission of light from a radioactive source", "None of the above"],        "correct": "The spontaneous transformation of an unstable nucleus into a more stable one"      },      {        "question": "91. What is meant by 'committed dose'?",        "options": ["The dose expected over a lifetime from an intake", "The dose measured in one hour", "The immediate dose from external exposure", "None of the above"],        "correct": "The dose expected over a lifetime from an intake"      },      {        "question": "92. What does 'radiation weighting factor' account for?",        "options": ["The different biological effectiveness of various radiation types", "The cost of shielding", "The half-life of radionuclides", "None of the above"],        "correct": "The different biological effectiveness of various radiation types"      },      {        "question": "93. What is the purpose of emergency preparedness in radiation protection?",        "options": ["To reduce the impact of radiation accidents", "To increase production", "To manage finances", "None of the above"],        "correct": "To reduce the impact of radiation accidents"      },      {        "question": "94. Which type of monitoring is used for environmental radiation?",        "options": ["Area monitoring", "Personal monitoring", "Both", "None of the above"],        "correct": "Area monitoring"      },      {        "question": "95. What does 'dose limitation' ensure in radiation protection?",        "options": ["That individual doses do not exceed prescribed limits", "That doses are as high as possible", "That doses are not measured", "None of the above"],        "correct": "That individual doses do not exceed prescribed limits"      },      {        "question": "96. What is the purpose of radiation shielding?",        "options": ["To reduce the amount of radiation reaching a person or area", "To increase radiation levels", "To produce radiation", "None of the above"],        "correct": "To reduce the amount of radiation reaching a person or area"      },      {        "question": "97. What is the primary unit for measuring absorbed dose?",        "options": ["Gray (Gy)", "Sievert (Sv)", "Becquerel (Bq)", "Curie (Ci)"],        "correct": "Gray (Gy)"      },      {        "question": "98. What is the primary unit for measuring effective dose?",        "options": ["Gray (Gy)", "Sievert (Sv)", "Becquerel (Bq)", "Curie (Ci)"],        "correct": "Sievert (Sv)"      },      {        "question": "99. What is a common effect of prolonged low-level radiation exposure?",        "options": ["Increased cancer risk", "Immediate burns", "Instant death", "None of the above"],        "correct": "Increased cancer risk"      },      {        "question": "100. What is the role of regulatory bodies like the NRRC in ensuring radiation safety?",        "options": ["To enforce radiation safety standards and regulations", "To manufacture radioactive materials", "To distribute dosimeters", "None of the above"],        "correct": "To enforce radiation safety standards and regulations",        "explanation": "Regulatory bodies such as the NRRC are tasked with setting and enforcing radiation protection standards, conducting inspections, authorizing the use and transport of radioactive materials, and taking corrective actions when safety limits are exceeded. They ensure that both occupational and public exposures remain within safe limits."      }    ];    // --- 5b: Split the questions into two sections ---    const section1Questions = quizData.slice(0, 50);    const section2Questions = quizData.slice(50, 100);section2Questions.forEach((q, i) => {  q.question = q.question.replace(/^\d+\./, `${i + 1}.`);})    // New Section 3 questions (35 questions extracted from NRRC regulations)const section3Questions = [  {    "question": "According to NRRC-R-01, what is the primary objective of the regulation?",    "options": [      "To enhance nuclear power generation efficiency",      "To set out the general safety requirements for protecting people and the environment against the harmful effects of ionizing radiation",      "To promote international nuclear cooperation",      "To regulate only medical exposures"    ],    "correct": "To set out the general safety requirements for protecting people and the environment against the harmful effects of ionizing radiation",    "explanation": "Section 1 of the regulation states that its objective is to establish general safety requirements for protection against the harmful effects of ionizing radiation."  },  {    "question": "Which legal instrument provides the basis for NRRC-R-01 regulation?",    "options": [      "The Law of Nuclear and Radiological Control (Royal Decree No. M/82)",      "The Environmental Protection Act",      "The Health and Safety Code",      "The International Atomic Energy Agency (IAEA) Statute"    ],    "correct": "The Law of Nuclear and Radiological Control (Royal Decree No. M/82)",    "explanation": "The preamble of NRRC-R-01 cites Royal Decree No. (M/82) as the basis for the regulation."  },  {    "question": "Which type of exposure is explicitly excluded from the scope of NRRC-R-01?",    "options": [      "Occupational exposure in nuclear facilities",      "Exposure from natural radioactivity in the body",      "Exposure from industrial radiography",      "Medical exposure during diagnostic procedures"    ],    "correct": "Exposure from natural radioactivity in the body",    "explanation": "Section 3 of the regulation lists exposures from natural radioactivity in the body as being excluded."  },  {    "question": "In NRRC-R-01, how is 'Absorbed dose, D' defined?",    "options": [      "The number of decays per second in a sample",      "The energy imparted by ionizing radiation per unit mass of a material",      "The cumulative dose received over a lifetime",      "The dose equivalent adjusted for biological effect"    ],    "correct": "The energy imparted by ionizing radiation per unit mass of a material",    "explanation": "The definition of absorbed dose is given as the energy imparted per unit mass."  },  {    "question": "What is the SI unit for activity as used in NRRC-R-01?",    "options": [      "Curie (Ci)",      "Gray (Gy)",      "Becquerel (Bq)",      "Sievert (Sv)"    ],    "correct": "Becquerel (Bq)",    "explanation": "Activity is measured in Becquerel, which represents one decay per second."  },  {    "question": "How is the physical half-life time (T1/2) defined in NRRC-R-01?",    "options": [      "The time it takes for the activity to decrease to 1/e of its original value",      "The time required for half of the atoms in a radioactive sample to decay",      "The time until the effective dose is halved",      "The time between consecutive radioactive decays"    ],    "correct": "The time required for half of the atoms in a radioactive sample to decay",    "explanation": "Physical half-life is defined as the period in which half of the radioactive atoms decay."  },  {    "question": "What is the mathematical relationship between the decay constant (λ) and the half-life (T1/2) as specified in NRRC-R-01?",    "options": [      "λ = T1/2",      "λ = ln2 / T1/2",      "λ = T1/2 / ln2",      "λ = 1 / T1/2"    ],    "correct": "λ = ln2 / T1/2",    "explanation": "The regulation defines the decay constant as λ = ln2 divided by the half-life."  },  {    "question": "What does 'Committed dose' refer to in the NRRC-R-01 regulation?",    "options": [      "The immediate dose measured at the time of exposure",      "The dose equivalent measured by personal dosimeters",      "The lifetime dose expected to result from an intake of radioactive material",      "The absorbed dose in a specific organ"    ],    "correct": "The lifetime dose expected to result from an intake of radioactive material",    "explanation": "Committed dose is defined as the lifetime dose from an intake, as per the regulation."  },  {    "question": "What is meant by 'Clearance' in the context of NRRC-R-01?",    "options": [      "The process of disposing of radioactive waste",      "The removal of a radiation source from regulatory control because its dose is too low",      "The measurement of radiation levels in a facility",      "The procedure to authorize a new radiation practice"    ],    "correct": "The removal of a radiation source from regulatory control because its dose is too low",    "explanation": "Clearance refers to removing regulatory control when the radiation level is sufficiently low."  },  {    "question": "For what purpose is a 'Dose constraint' used in NRRC-R-01?",    "options": [      "To set the minimum necessary dose for medical treatment",      "To serve as a boundary in optimizing protection in planned exposure situations",      "To indicate the maximum allowed dose for emergency situations",      "To calculate the effective dose received by an individual"    ],    "correct": "To serve as a boundary in optimizing protection in planned exposure situations",    "explanation": "Dose constraints are used to optimize protection measures by setting boundaries on individual doses."  },  {    "question": "How is 'Effective dose, E' determined according to NRRC-R-01?",    "options": [      "By summing the absorbed doses in all tissues without weighting",      "By multiplying the absorbed dose by the dose rate",      "By summing tissue equivalent doses each multiplied by the appropriate tissue weighting factor",      "By averaging the committed and absorbed doses"    ],    "correct": "By summing tissue equivalent doses each multiplied by the appropriate tissue weighting factor",    "explanation": "Effective dose is calculated as the sum of tissue doses multiplied by their weighting factors."  },  {    "question": "Which of the following responsibilities is addressed in Chapter 3 of NRRC-R-01?",    "options": [      "Optimization of protection measures",      "General responsibilities for protection and safety",      "Management of nuclear fuel cycles",      "Design of radiological equipment"    ],    "correct": "General responsibilities for protection and safety",    "explanation": "Chapter 3 outlines the responsibilities for ensuring protection and safety."  },  {    "question": "What does Chapter 2 of NRRC-R-01 primarily focus on?",    "options": [      "Emergency response procedures",      "General requirements on the application of the system of protection",      "Quality assurance for consumer products",      "Management of radioactive waste"    ],    "correct": "General requirements on the application of the system of protection",    "explanation": "Chapter 2 is dedicated to the general application of protection systems."  },  {    "question": "What is the role of 'Reference Levels' as mentioned in NRRC-R-01?",    "options": [      "They are the absolute dose limits for public exposure",      "They serve as guidance levels for the optimization of protection",      "They are used to calculate the effective dose",      "They indicate the level of natural background radiation"    ],    "correct": "They serve as guidance levels for the optimization of protection",    "explanation": "Reference levels provide guidance to help optimize protection measures."  },  {    "question": "Which chapter of NRRC-R-01 deals with Emergency Preparedness and Response?",    "options": [      "Chapter 5",      "Chapter 8",      "Chapter 10",      "Chapter 12"    ],    "correct": "Chapter 8",    "explanation": "Chapter 8 is focused on Emergency Preparedness and Response."  },  {    "question": "What does 'Regulatory Inspection of Facility' aim to ensure according to NRRC-R-01?",    "options": [      "That facilities meet production targets",      "That facilities comply with safety standards",      "That only new facilities are inspected",      "That dosimetry is performed annually"    ],    "correct": "That facilities comply with safety standards",    "explanation": "Regulatory inspections are conducted to verify compliance with established safety standards."  },  {    "question": "Who is primarily responsible for overseeing radiation safety in a facility as per NRRC-R-01?",    "options": [      "The facility manager",      "The Radiation Safety Officer (RSO)",      "The head of production",      "The quality assurance department"    ],    "correct": "The Radiation Safety Officer (RSO)",    "explanation": "The regulation designates the Radiation Safety Officer as the key person overseeing safety."  },  {    "question": "What does 'Safety Culture' mean in the context of NRRC-R-01?",    "options": [      "The implementation of technical safety systems only",      "A shared commitment and attitude towards safety within an organization",      "Strict enforcement of administrative rules",      "Regular external audits of facilities"    ],    "correct": "A shared commitment and attitude towards safety within an organization",    "explanation": "Safety Culture refers to the collective attitude that prioritizes safety at all levels."  },  {    "question": "Which chapter of NRRC-R-01 addresses Occupational Exposure?",    "options": [      "Chapter 7",      "Chapter 10",      "Chapter 3",      "Chapter 12"    ],    "correct": "Chapter 10",    "explanation": "Chapter 10 deals with the requirements and responsibilities concerning Occupational Exposure."  },  {    "question": "What is the purpose of a 'Radiation Protection Program' according to NRRC-R-01?",    "options": [      "To ensure optimal production in nuclear facilities",      "To systematically manage and implement radiation protection measures",      "To monitor natural background radiation only",      "To authorize medical exposures exclusively"    ],    "correct": "To systematically manage and implement radiation protection measures",    "explanation": "The Radiation Protection Program is a systematic approach for ensuring adequate protection measures."  },  {    "question": "What are 'Monitoring Programs' designed to do in NRRC-R-01?",    "options": [      "Increase the production of radioactive materials",      "Ensure regular testing and verification of compliance with safety standards",      "Replace the need for personal dosimetry",      "Only measure emergency exposures"    ],    "correct": "Ensure regular testing and verification of compliance with safety standards",    "explanation": "Monitoring Programs are implemented to continuously assess and verify that safety standards are being met."  },  {    "question": "How is 'Decontamination' defined in NRRC-R-01?",    "options": [      "As the process of increasing radiation exposure",      "As the complete or partial removal of radioactive contamination",      "As a method for energy absorption",      "As a system for recording exposure"    ],    "correct": "As the complete or partial removal of radioactive contamination",    "explanation": "Decontamination involves the removal of unwanted radioactive materials from surfaces or objects."  },  {    "question": "What does the 'Graded approach' in NRRC-R-01 refer to?",    "options": [      "An approach where all facilities receive the same level of scrutiny",      "An approach where the stringency of control measures is commensurate with the level of risk",      "A method for classifying radioactive sources solely by activity",      "A technique for increasing production efficiency"    ],    "correct": "An approach where the stringency of control measures is commensurate with the level of risk",    "explanation": "The graded approach ensures that control measures are applied in proportion to the risk involved."  },  {    "question": "In NRRC-R-01, what is the function of 'Notification'?",    "options": [      "To announce public events",      "To submit a document to NRRC by a person intending to carry out radiation-related practices",      "To register a facility for nuclear power generation",      "To schedule an inspection"    ],    "correct": "To submit a document to NRRC by a person intending to carry out radiation-related practices",    "explanation": "Notification is the process by which applicants inform the NRRC of their intended practices."  },  {    "question": "What does 'Release from Regulatory Control' mean in NRRC-R-01?",    "options": [      "It indicates the termination of a facility",      "It means that a source or practice is no longer subject to regulatory oversight because the radiation exposure is below a set threshold",      "It is the process of increasing operational limits",      "It is used to authorize emergency responses"    ],    "correct": "It means that a source or practice is no longer subject to regulatory oversight because the radiation exposure is below a set threshold",    "explanation": "Release from regulatory control occurs when the exposure level is sufficiently low to remove ongoing oversight."  },  {    "question": "Which chapter of NRRC-R-01 discusses the management of radiation generators and radioactive sources?",    "options": [      "Chapter 11",      "Chapter 13",      "Chapter 8",      "Chapter 5"    ],    "correct": "Chapter 13",    "explanation": "Chapter 13 addresses the safety requirements and management of radiation generators and radioactive sources."  },  {    "question": "What is meant by 'Consumer Products' under NRRC-R-01?",    "options": [      "Products used exclusively in medical imaging",      "Devices or items containing radionuclides that are made available to the public without special regulatory control",      "Industrial machinery with built-in radiation shielding",      "High-activity sources used in nuclear reactors"    ],    "correct": "Devices or items containing radionuclides that are made available to the public without special regulatory control",    "explanation": "Consumer products in this context refer to items that incorporate radionuclides and are sold to the public under specified conditions."  },  {    "question": "What is the purpose of maintaining 'Records of Occupational Exposure' as per NRRC-R-01?",    "options": [      "To determine production rates",      "To document individual worker exposures for compliance and monitoring",      "To authorize facility shutdowns",      "To calculate tax liabilities"    ],    "correct": "To document individual worker exposures for compliance and monitoring",    "explanation": "Records of Occupational Exposure help ensure that workers’ doses are tracked and remain within prescribed limits."  },  {    "question": "How is 'Quality Assurance' defined in NRRC-R-01?",    "options": [      "A set of measures to boost production efficiency",      "A system designed to ensure that specified safety requirements are consistently fulfilled",      "A process for emergency response planning",      "A method for increasing radiation output"    ],    "correct": "A system designed to ensure that specified safety requirements are consistently fulfilled",    "explanation": "Quality assurance is a management function that ensures safety standards and procedures are maintained."  },  {    "question": "What does the 'Radiation Protection Program' aim to achieve according to NRRC-R-01?",    "options": [      "It aims to maximize the use of radioactive materials",      "It aims to systematically implement and manage measures for protecting people against radiation exposure",      "It aims to provide a marketing strategy for nuclear products",      "It is only applicable to emergency situations"    ],    "correct": "It aims to systematically implement and manage measures for protecting people against radiation exposure",    "explanation": "The Radiation Protection Program is a comprehensive system for managing all aspects of radiation safety."  },  {    "question": "What is an 'Exposure pathway' as defined in NRRC-R-01?",    "options": [      "The route by which radiation or radionuclides reach humans",      "The process of decontamination of a facility",      "A method for calculating absorbed dose",      "A type of radiation monitoring device"    ],    "correct": "The route by which radiation or radionuclides reach humans",    "explanation": "Exposure pathway refers to the route through which radioactive substances can enter the human body."  },  {    "question": "How is 'Occupational Exposure' described in NRRC-R-01?",    "options": [      "Exposure experienced by the general public",      "Exposure that occurs only during emergency situations",      "Exposure of workers incurred in the course of their employment",      "Exposure solely from natural sources"    ],    "correct": "Exposure of workers incurred in the course of their employment",    "explanation": "Occupational exposure is specifically defined as the exposure of workers during their job activities."  },  {    "question": "Which section or chapter of NRRC-R-01 discusses 'Regulatory Inspection of Facility'?",    "options": [      "It is outlined in Chapter 5, which covers requirements for the management of protection and safety",      "Chapter 2 exclusively",      "Chapter 8 exclusively",      "It is not mentioned in the regulation"    ],    "correct": "It is outlined in Chapter 5, which covers requirements for the management of protection and safety",    "explanation": "Chapter 5 includes the provisions for regulatory inspection to ensure facility compliance."  },  {    "question": "What is the purpose of a 'Safety Assessment' as described in NRRC-R-01?",    "options": [      "To determine production efficiency of nuclear facilities",      "To verify safety by evaluating protection measures and potential risks",      "To calculate the exact dose received by every worker",      "To authorize the use of consumer products"    ],    "correct": "To verify safety by evaluating protection measures and potential risks",    "explanation": "Safety assessment involves a systematic evaluation of protection measures to ensure they are effective."  }];    const section4Content = `  <div class="section4-content">    <h1>40 Radiation Safety Scenario Questions</h1>    <!-- Scenario 1 -->    <div class="scenario">      <h2>Scenario 1: New Medical Facility Licensing</h2>      <p><strong>Scenario:</strong> A new medical center installs an X-ray machine and the owner wants to start using it immediately without waiting for paperwork.</p>      <p><strong>Question:</strong> Is it legally permissible to operate the X-ray machine right after installation?</p>      <div class="answer-wrapper blurred">        <p class="explanation"><strong>Explanation:</strong> According to NRRC-R-01, any radiation-emitting equipment must be licensed and approved by the regulatory authority before operation. The proper application, inspection, and issuance of a license are mandatory.</p>      </div>    </div>    <!-- Scenario 2 -->    <div class="scenario">      <h2>Scenario 2: Expired License</h2>      <p><strong>Scenario:</strong> You discover that the facility’s license for handling radioactive materials expired last month, yet operations continue.</p>      <p><strong>Question:</strong> Can the facility legally continue its operations?</p>      <div class="answer-wrapper blurred">        <p class="explanation"><strong>Explanation:</strong> Operating with an expired license is a violation of NRRC-R-01. The facility must immediately halt operations and renew the license to comply with regulatory requirements.</p>      </div>    </div>    <!-- Scenario 3 -->    <div class="scenario">      <h2>Scenario 3: Transporting Radioactive Material</h2>      <p><strong>Scenario:</strong> A transport company with only a general transport permit is hired to move sealed radioactive sources between licensed facilities.</p>      <p><strong>Question:</strong> Can they legally transport the radioactive material?</p>      <div class="answer-wrapper blurred">        <p class="explanation"><strong>Explanation:</strong> Special permits for radioactive material transport are required. A general transport permit is insufficient under NRRC-R-01, which mandates proper authorization, trained personnel, and specialized containers.</p>      </div>    </div>    <!-- Scenario 4 -->    <div class="scenario">      <h2>Scenario 4: Unauthorized Radioactive Source</h2>      <p><strong>Scenario:</strong> During an internal audit, you find an old radioactive source stored in the facility that isn’t listed on the license.</p>      <p><strong>Question:</strong> What actions should you take immediately?</p>      <div class="answer-wrapper blurred">        <p class="explanation"><strong>Explanation:</strong> NRRC-R-01 requires all radioactive sources to be registered. An unregistered source is a major violation. It must be secured, reported to the regulatory authority, and either properly registered or safely disposed of.</p>      </div>    </div>    <!-- Scenario 5 -->    <div class="scenario">      <h2>Scenario 5: Emergency Radiation Exposure</h2>      <p><strong>Scenario:</strong> A worker receives 50 mSv during an emergency response involving a damaged source.</p>      <p><strong>Question:</strong> Is this exposure acceptable under emergency conditions?</p>      <div class="answer-wrapper blurred">        <p class="explanation"><strong>Explanation:</strong> Emergency exposure may allow doses up to 50 mSv if justified, but it requires immediate medical evaluation, strict documentation, and follow-up actions to ensure long-term health and regulatory compliance.</p>      </div>    </div>    <!-- Scenario 6 -->    <div class="scenario">      <h2>Scenario 6: Occupational Exposure Near Limit</h2>      <p><strong>Scenario:</strong> A technician’s recorded dose reaches 18 mSv by mid-year.</p>      <p><strong>Question:</strong> Should the technician’s work be suspended?</p>      <div class="answer-wrapper blurred">        <p class="explanation"><strong>Explanation:</strong> With an annual limit of about 20 mSv (averaged over 5 years and not exceeding 50 mSv in a single year), preventive measures—such as reassigning tasks and increasing monitoring—are required to avoid exceeding limits.</p>      </div>    </div>    <!-- Scenario 7 -->    <div class="scenario">      <h2>Scenario 7: Public Exposure Exceeding Limits</h2>      <p><strong>Scenario:</strong> Monitoring shows that a neighboring residential area might receive 1.2 mSv per year from facility discharges.</p>      <p><strong>Question:</strong> What corrective actions are needed?</p>      <div class="answer-wrapper blurred">        <p class="explanation"><strong>Explanation:</strong> The public dose limit is 1 mSv per year. Measures such as enhancing shielding, modifying operations, or adding containment systems must be implemented immediately to reduce exposure.</p>      </div>    </div>    <!-- Scenario 8 -->    <div class="scenario">      <h2>Scenario 8: Implementing a Radiation Protection Program</h2>      <p><strong>Scenario:</strong> Your facility is developing a radiation protection program but lacks detailed documentation.</p>      <p><strong>Question:</strong> What key elements must be included in the program?</p>      <div class="answer-wrapper blurred">        <p class="explanation"><strong>Explanation:</strong> The program must document responsibilities, training, dose monitoring, emergency procedures, and corrective actions in line with NRRC-R-01 requirements.</p>      </div>    </div>    <!-- Scenario 9 -->    <div class="scenario">      <h2>Scenario 9: Radiation Safety Officer Appointment</h2>      <p><strong>Scenario:</strong> A facility is operating without a designated Radiation Safety Officer (RSO).</p>      <p><strong>Question:</strong> What are the regulatory implications and required actions?</p>      <div class="answer-wrapper blurred">        <p class="explanation"><strong>Explanation:</strong> NRRC-R-01 mandates the appointment of an RSO to oversee radiation protection. The facility must immediately designate an RSO and document their duties and authority.</p>      </div>    </div>    <!-- Scenario 10 -->    <div class="scenario">      <h2>Scenario 10: Qualified Expert Involvement</h2>      <p><strong>Scenario:</strong> A facility performs complex radiological procedures without consulting a qualified expert.</p>      <p><strong>Question:</strong> Is this acceptable?</p>      <div class="answer-wrapper blurred">        <p class="explanation"><strong>Explanation:</strong> No. NRRC-R-01 requires that complex procedures be overseen by qualified experts (e.g., medical physicists) to ensure safety and compliance.</p>      </div>    </div>    <!-- Scenario 11 -->    <div class="scenario">      <h2>Scenario 11: Safety Culture & Training</h2>      <p><strong>Scenario:</strong> Employees are not receiving regular radiation safety training.</p>      <p><strong>Question:</strong> What must be done to comply with the regulations?</p>      <div class="answer-wrapper blurred">        <p class="explanation"><strong>Explanation:</strong> A robust safety culture with periodic training is essential. NRRC-R-01 requires ongoing education, clear communication of safety procedures, and regular drills.</p>      </div>    </div>    <!-- Scenario 12 -->    <div class="scenario">      <h2>Scenario 12: Controlled Area Classification</h2>      <p><strong>Scenario:</strong> Your facility is reassessing its controlled and supervised area boundaries.</p>      <p><strong>Question:</strong> How should controlled areas be determined?</p>      <div class="answer-wrapper blurred">        <p class="explanation"><strong>Explanation:</strong> Controlled areas must be defined based on the likelihood and magnitude of radiation exposure, with appropriate signage, access restrictions, and safety measures as stipulated in NRRC-R-01.</p>      </div>    </div>    <!-- Scenario 13 -->    <div class="scenario">      <h2>Scenario 13: Establishing Local Safety Rules</h2>      <p><strong>Scenario:</strong> No written local rules exist for radiation safety in a specific department.</p>      <p><strong>Question:</strong> What steps should be taken?</p>      <div class="answer-wrapper blurred">        <p class="explanation"><strong>Explanation:</strong> Local rules must be developed in consultation with workers. They should clearly outline procedures, responsibilities, and emergency actions, in accordance with NRRC-R-01.</p>      </div>    </div>    <!-- Scenario 14 -->    <div class="scenario">      <h2>Scenario 14: Personal Protective Equipment (PPE)</h2>      <p><strong>Scenario:</strong> A worker complains that the provided PPE is inadequate.</p>      <p><strong>Question:</strong> What are the PPE requirements under the regulations?</p>      <div class="answer-wrapper blurred">        <p class="explanation"><strong>Explanation:</strong> The facility must provide PPE that meets established standards. Training on proper use, regular maintenance, and fit testing are all required as per NRRC-R-01.</p>      </div>    </div>    <!-- Scenario 15 -->    <div class="scenario">      <h2>Scenario 15: Workplace Monitoring Program</h2>      <p><strong>Scenario:</strong> Routine monitoring shows fluctuating radiation levels in the workplace.</p>      <p><strong>Question:</strong> What actions should be taken?</p>      <div class="answer-wrapper blurred">        <p class="explanation"><strong>Explanation:</strong> A continuous and comprehensive monitoring program is required. Any irregularities must be investigated, and corrective actions taken to ensure exposure remains within safe limits.</p>      </div>    </div>    <!-- Scenario 16 -->    <div class="scenario">      <h2>Scenario 16: Individual Dosimetry</h2>      <p><strong>Scenario:</strong> Some workers are not consistently wearing their personal dosimeters.</p>      <p><strong>Question:</strong> Why is individual dosimetry important?</p>      <div class="answer-wrapper blurred">        <p class="explanation"><strong>Explanation:</strong> Personal dosimeters are crucial for accurately tracking individual exposure levels, ensuring that doses remain within prescribed limits, and for triggering corrective actions if needed.</p>      </div>    </div>    <!-- Scenario 17 -->    <div class="scenario">      <h2>Scenario 17: Reporting an Exposure Incident</h2>      <p><strong>Scenario:</strong> A minor overexposure incident occurs but is not immediately reported.</p>      <p><strong>Question:</strong> What are the reporting obligations?</p>      <div class="answer-wrapper blurred">        <p class="explanation"><strong>Explanation:</strong> NRRC-R-01 requires all incidents—even minor overexposures—to be reported promptly with details such as time, cause, exposure levels, and corrective actions taken.</p>      </div>    </div>    <!-- Scenario 18 -->    <div class="scenario">      <h2>Scenario 18: Emergency Preparedness Plan</h2>      <p><strong>Scenario:</strong> The facility’s emergency preparedness plan has not been updated in over two years.</p>      <p><strong>Question:</strong> What must be done regarding the emergency plan?</p>      <div class="answer-wrapper blurred">        <p class="explanation"><strong>Explanation:</strong> The emergency plan must be reviewed and updated regularly to reflect current operations, include clear procedures for incident response, and ensure adequate resources are in place.</p>      </div>    </div>    <!-- Scenario 19 -->    <div class="scenario">      <h2>Scenario 19: Calibration of Radiation Equipment</h2>      <p><strong>Scenario:</strong> A calibration check reveals discrepancies in the output of an X-ray machine.</p>      <p><strong>Question:</strong> What steps must be taken?</p>      <div class="answer-wrapper blurred">        <p class="explanation"><strong>Explanation:</strong> Equipment must be calibrated per NRRC-R-01 standards. Discrepancies require immediate recalibration, corrective actions, and thorough documentation to maintain accurate dosimetry.</p>      </div>    </div>    <!-- Scenario 20 -->    <div class="scenario">      <h2>Scenario 20: Medical Exposure Justification</h2>      <p><strong>Scenario:</strong> A physician recommends a radiological procedure without proper justification documentation.</p>      <p><strong>Question:</strong> Is this acceptable?</p>      <div class="answer-wrapper blurred">        <p class="explanation"><strong>Explanation:</strong> Every medical exposure must be justified by balancing benefits and risks, with full documentation as required by NRRC-R-01. Without this, the procedure is not compliant.</p>      </div>    </div>    <!-- Scenario 21 -->    <div class="scenario">      <h2>Scenario 21: Involvement of Medical Personnel</h2>      <p><strong>Scenario:</strong> A radiological procedure is performed without the oversight of a qualified radiologist.</p>      <p><strong>Question:</strong> What does NRRC-R-01 require?</p>      <div class="answer-wrapper blurred">        <p class="explanation"><strong>Explanation:</strong> NRRC-R-01 mandates that qualified medical personnel—including a radiologist, medical physicist, and technologist—be involved in procedures to ensure patient safety and proper dose management.</p>      </div>    </div>    <!-- Scenario 22 -->    <div class="scenario">      <h2>Scenario 22: Diagnostic Reference Levels</h2>      <p><strong>Scenario:</strong> Routine diagnostic imaging procedures are consistently exceeding established reference levels.</p>      <p><strong>Question:</strong> What corrective actions must be taken?</p>      <div class="answer-wrapper blurred">        <p class="explanation"><strong>Explanation:</strong> Exceeding diagnostic reference levels indicates potential overexposure. The facility must review and optimize imaging protocols, adjust equipment settings, and implement ALARA principles as required by NRRC-R-01.</p>      </div>    </div>    <!-- Scenario 23 -->    <div class="scenario">      <h2>Scenario 23: Quality Assurance in Medical Procedures</h2>      <p><strong>Scenario:</strong> The quality assurance program for radiological procedures is incomplete.</p>      <p><strong>Question:</strong> What elements are essential in the QA program?</p>      <div class="answer-wrapper blurred">        <p class="explanation"><strong>Explanation:</strong> A comprehensive QA program must include regular equipment checks, calibration, dose audits, documentation, and corrective actions to ensure compliance with NRRC-R-01 and safeguard patient and worker safety.</p>      </div>    </div>    <!-- Scenario 24 -->    <div class="scenario">      <h2>Scenario 24: Special Measures for Pregnant Workers</h2>      <p><strong>Scenario:</strong> A pregnant worker is scheduled to work in an area with potentially high radiation exposure.</p>      <p><strong>Question:</strong> What protective measures are required?</p>      <div class="answer-wrapper blurred">        <p class="explanation"><strong>Explanation:</strong> NRRC-R-01 requires that pregnant workers have their exposure limited (typically to around 1 mSv for the remainder of the pregnancy) through reassigning tasks, enhanced shielding, and strict monitoring.</p>      </div>    </div>    <!-- Scenario 25 -->    <div class="scenario">      <h2>Scenario 25: Training of Radiation Workers</h2>      <p><strong>Scenario:</strong> New hires at the facility have not yet received radiation safety training.</p>      <p><strong>Question:</strong> What does the regulation require?</p>      <div class="answer-wrapper blurred">        <p class="explanation"><strong>Explanation:</strong> NRRC-R-01 mandates comprehensive initial training and periodic retraining in radiation protection, proper equipment usage, emergency procedures, and dose management for all workers.</p>      </div>    </div>    <!-- Scenario 26 -->    <div class="scenario">      <h2>Scenario 26: Managing Exposure for Outside Workers</h2>      <p><strong>Scenario:</strong> Contractors working in the facility are exposed to radiation, but their employer is not directly responsible for radiation safety.</p>      <p><strong>Question:</strong> How should their exposure be managed?</p>      <div class="answer-wrapper blurred">        <p class="explanation"><strong>Explanation:</strong> Both the facility and the contractor’s employer must collaborate to ensure proper dosimetry, training, and protection measures for outside workers, in line with NRRC-R-01.</p>      </div>    </div>    <!-- Scenario 27 -->    <div class="scenario">      <h2>Scenario 27: Record-Keeping for Occupational Doses</h2>      <p><strong>Scenario:</strong> The facility’s records of individual radiation doses are incomplete.</p>      <p><strong>Question:</strong> What are the record-keeping requirements?</p>      <div class="answer-wrapper blurred">        <p class="explanation"><strong>Explanation:</strong> Detailed records of individual doses must be maintained for extended periods (often 30 years post-exposure), including exposure assessments, corrective actions, and periodic reviews, as specified by NRRC-R-01.</p>      </div>    </div>    <!-- Scenario 28 -->    <div class="scenario">      <h2>Scenario 28: Environmental Monitoring</h2>      <p><strong>Scenario:</strong> There is insufficient environmental data on radioactive discharges from the facility.</p>      <p><strong>Question:</strong> What does the regulation require regarding environmental monitoring?</p>      <div class="answer-wrapper blurred">        <p class="explanation"><strong>Explanation:</strong> NRRC-R-01 requires a comprehensive environmental monitoring program to measure discharges, ambient dose rates, and radioactivity in the environment to ensure public exposure remains within legal limits.</p>      </div>    </div>    <!-- Scenario 29 -->    <div class="scenario">      <h2>Scenario 29: Radiation Discharge Limits</h2>      <p><strong>Scenario:</strong> Measured discharge levels are approaching regulatory limits.</p>      <p><strong>Question:</strong> What corrective actions are necessary?</p>      <div class="answer-wrapper blurred">        <p class="explanation"><strong>Explanation:</strong> Immediate corrective measures must be taken to reduce emissions—this may include operational changes, improved containment, and additional shielding—to ensure compliance with the 1 mSv/year public dose limit as per NRRC-R-01.</p>      </div>    </div>    <!-- Scenario 30 -->    <div class="scenario">      <h2>Scenario 30: Clearance of Radioactive Materials</h2>      <p><strong>Scenario:</strong> A batch of waste material is being evaluated for clearance from regulatory control.</p>      <p><strong>Question:</strong> Under what conditions can clearance be granted?</p>      <div class="answer-wrapper blurred">        <p class="explanation"><strong>Explanation:</strong> Clearance is only allowed if the material’s radioactivity is below the specified clearance levels, ensuring negligible exposure risk. Proper documentation and regulatory approval are required as per NRRC-R-01.</p>      </div>    </div>    <!-- Scenario 31 -->    <div class="scenario">      <h2>Scenario 31: Radioactive Waste Management</h2>      <p><strong>Scenario:</strong> The facility is generating a significant amount of radioactive waste.</p>      <p><strong>Question:</strong> What responsibilities does the facility have regarding waste management?</p>      <div class="answer-wrapper blurred">        <p class="explanation"><strong>Explanation:</strong> NRRC-R-01 requires safe management of radioactive waste, including segregation, characterization, classification, proper storage, and adherence to waste acceptance criteria to protect the environment and public health.</p>      </div>    </div>    <!-- Scenario 32 -->    <div class="scenario">      <h2>Scenario 32: Segregation of Radioactive Waste</h2>      <p><strong>Scenario:</strong> Different types of radioactive waste are being stored together without proper segregation.</p>      <p><strong>Question:</strong> What does the regulation require?</p>      <div class="answer-wrapper blurred">        <p class="explanation"><strong>Explanation:</strong> Waste must be segregated according to type and activity level to prevent cross-contamination and to ensure each waste stream is managed in accordance with its specific requirements as defined by NRRC-R-01.</p>      </div>    </div>    <!-- Scenario 33 -->    <div class="scenario">      <h2>Scenario 33: Acceptance Criteria for Radioactive Waste</h2>      <p><strong>Scenario:</strong> The facility is preparing to transfer waste to a disposal site.</p>      <p><strong>Question:</strong> What must be verified before the transfer?</p>      <div class="answer-wrapper blurred">        <p class="explanation"><strong>Explanation:</strong> The waste must meet all acceptance criteria—including limits on activity levels and proper physical form—and be accompanied by thorough documentation, as required by NRRC-R-01.</p>      </div>    </div>    <!-- Scenario 34 -->    <div class="scenario">      <h2>Scenario 34: Decommissioning of Radiation Sources</h2>      <p><strong>Scenario:</strong> A facility plans to decommission an old radiation source.</p>      <p><strong>Question:</strong> What steps are required during decommissioning?</p>      <div class="answer-wrapper blurred">        <p class="explanation"><strong>Explanation:</strong> A complete safety assessment, proper removal from regulatory control, safe disposal or recycling, and detailed record-keeping are required during decommissioning per NRRC-R-01.</p>      </div>    </div>    <!-- Scenario 35 -->    <div class="scenario">      <h2>Scenario 35: Radiological Generator Safety</h2>      <p><strong>Scenario:</strong> A radiological generator is malfunctioning.</p>      <p><strong>Question:</strong> What actions must be taken?</p>      <div class="answer-wrapper blurred">        <p class="explanation"><strong>Explanation:</strong> The generator must be shut down immediately, inspected, repaired, and recalibrated. An investigation must be conducted to document the failure and prevent future incidents, in accordance with NRRC-R-01.</p>      </div>    </div>    <!-- Scenario 36 -->    <div class="scenario">      <h2>Scenario 36: Consumer Product Labeling for Radiation</h2>      <p><strong>Scenario:</strong> A consumer product containing radioactive material is found to be mislabeled.</p>      <p><strong>Question:</strong> What are the labeling requirements?</p>      <div class="answer-wrapper blurred">        <p class="explanation"><strong>Explanation:</strong> NRRC-R-01 requires that consumer products with radioactive content be clearly labeled with details about the radionuclides, activity levels, and safety/disposal instructions to protect users.</p>      </div>    </div>    <!-- Scenario 37 -->    <div class="scenario">      <h2>Scenario 37: Remediation of Contaminated Areas</h2>      <p><strong>Scenario:</strong> An area within the facility is contaminated with residual radioactive material.</p>      <p><strong>Question:</strong> What steps must be taken to remediate the area?</p>      <div class="answer-wrapper blurred">        <p class="explanation"><strong>Explanation:</strong> A detailed remediation plan must be developed, including a safety assessment, waste management strategies, exposure reduction measures, public involvement, and ongoing monitoring as per NRRC-R-01.</p>      </div>    </div>    <!-- Scenario 38 -->    <div class="scenario">      <h2>Scenario 38: Remedial Action Plan Implementation</h2>      <p><strong>Scenario:</strong> A remedial action plan for a contaminated site is underway.</p>      <p><strong>Question:</strong> What key elements must the plan include?</p>      <div class="answer-wrapper blurred">        <p class="explanation"><strong>Explanation:</strong> The plan should detail the remediation process, emergency measures, waste management, monitoring protocols, timelines, responsibilities, and documentation procedures to ensure the site is restored to safe conditions per NRRC-R-01.</p>      </div>    </div>    <!-- Scenario 39 -->    <div class="scenario">      <h2>Scenario 39: Existing Exposure Situations</h2>      <p><strong>Scenario:</strong> A facility is managing residual radioactive contamination from past activities.</p>      <p><strong>Question:</strong> What strategy is required for managing existing exposures?</p>      <div class="answer-wrapper blurred">        <p class="explanation"><strong>Explanation:</strong> NRRC-R-01 requires a protection strategy for existing exposure situations that includes dose assessments, remedial actions, continuous monitoring, regulatory approval, and detailed record-keeping to minimize public exposure.</p>      </div>    </div>    <!-- Scenario 40 -->    <div class="scenario">      <h2>Scenario 40: Aircrew Exposure to Cosmic Radiation</h2>      <p><strong>Scenario:</strong> An airline operator must monitor the cosmic radiation exposure of its aircrew.</p>      <p><strong>Question:</strong> What measures should be implemented?</p>      <div class="answer-wrapper blurred">        <p class="explanation"><strong>Explanation:</strong> The operator must assess aircrew doses using personal dosimeters, maintain dose records, adjust flight schedules if necessary, and provide information about the risks of cosmic radiation as required by NRRC-R-01.</p>      </div>    </div>  </div>`;    let sections = {  section1: {    title: "Section 1: Basic Radiation Protection",    type: "MCQ",           // "MCQ" or "Scenario"    questions: section1Questions  },  section2: {    title: "Section 2: Radiation Physics",    type: "MCQ",    questions: section2Questions  },  section3: {    title: "Section 3: NRRC Regulations",    type: "MCQ",    questions: section3Questions  },  section4: {    title: "Section 4: Radiation Safety Scenarios",    type: "Scenario",    content: section4Content   // Keep original content for scenarios  }};function updateSectionCardCounts() {  Object.keys(sections).forEach(key => {    const card = document.querySelector(`.section-card[data-section="${key}"]`);    if (!card) return;    const countEl = card.querySelector('.question-count');    if (!countEl) return;    const section = sections[key];        if (key === "section4" || section.type === "Scenario") {      const count = section.content ?         (section.content.match(/class="answer-wrapper/g) || []).length : 0;      countEl.textContent = `${count} scenarios`;    } else {      const count = section.questions ? section.questions.length : 0;      countEl.textContent = `${count} questions`;    }  });}    /* NEW FUNCTIONS - added after revertChanges() */    function deleteAllSections() {      if (!isEditMode) {        alert("Please enable Edit Mode first.");        return;      }      if (confirm("⚠️ WARNING: This will DELETE ALL SECTIONS permanently!\n\nAll questions, timers, progress, and custom changes will be lost.\n\nThis cannot be undone.\n\nContinue?")) {        sections = {};        Object.keys(sectionTimers).forEach(k => delete sectionTimers[k]);        Object.keys(sectionAnsweredCount).forEach(k => delete sectionAnsweredCount[k]);        Object.keys(sectionLuckResults).forEach(k => delete sectionLuckResults[k]);        Object.keys(luckUsed).forEach(k => delete luckUsed[k]);        Object.keys(sectionSchrodingTime).forEach(k => delete sectionSchrodingTime[k]);                refreshSectionCards();        if (quizSectionEl.style.display === 'block') backToSections();        alert("✅ All sections have been permanently deleted.");      }    }    function addNewSection() {  // Auto-enable Edit Mode when there are no sections yet  if (Object.keys(sections).length === 0 && !isEditMode) {    toggleEditMode();   // silently turn on Edit Mode  }   // If there are already sections, ask for confirmation  else if (!isEditMode) {    if (!confirm("Adding a new section requires Edit Mode.\n\nEnable Edit Mode now?")) {      return;    }    toggleEditMode();  }  // Create the new sample section  const existingKeys = Object.keys(sections).filter(k => k.match(/^section\d+$/));  const nextNum = existingKeys.length + 1;  const newKey = `section${nextNum}`;  sections[newKey] = {    title: "Sample Section",    type: "MCQ",    questions: [{      question: "Sample Question: What is the SI unit for absorbed dose?",      options: ["Gray (Gy)", "Sievert (Sv)", "Becquerel (Bq)", "Curie (Ci)"],      correct: "Gray (Gy)"    }]  };  sectionTimers[newKey] = 1800 * 1000;  sectionAnsweredCount[newKey] = 0;  sectionLuckResults[newKey] = null;  luckUsed[newKey] = false;  sectionSchrodingTime[newKey] = null;  refreshSectionCards();  // Auto-open the newly created section  setTimeout(() => {    const newCard = document.querySelector(`.section-card[data-section="${newKey}"]`);    if (newCard) cardClick(newCard, newKey);  }, 80);}    /* UPDATED refreshSectionCards() - add this version */    function refreshSectionCards() {  const container = document.querySelector('.section-container');  if (!container) return;  container.innerHTML = '';  let displayNum = 1;  Object.keys(sections).forEach(key => {    const sec = sections[key];    const count = sec.questions ? sec.questions.length : 0;    const isScenario = (sec.type === "Scenario" || key === "section4");    let cleanTitle = sec.title.replace(/^Section \d+:\s*/i, '').trim();    const card = document.createElement('div');    card.className = 'section-card';    card.dataset.section = key;    card.tabIndex = 0;    card.innerHTML = `      <div class="card-inner">        <h2>Section ${displayNum}: ${cleanTitle}</h2>        <p>${isScenario ? 'Radiation Safety Scenarios' : 'MCQ Questions'}</p>        <p class="section-timer">Time left: 30:00</p>        <p class="question-count">${count} ${isScenario ? 'scenarios' : 'questions'}</p>        <div class="progress-container section-progress">          <div class="progress-bar" style="width: 0%;"></div>        </div>      </div>    `;    card.addEventListener('click', function() { cardClick(this, key); });    container.appendChild(card);    displayNum++;  });  // ==================== ADD SECTION CARD LOGIC ====================  const hasAnySections = Object.keys(sections).length > 0;    if (!hasAnySections || isEditMode) {    const addCard = document.createElement('div');    addCard.className = 'section-card add-section-card';    addCard.dataset.section = 'add-new';    addCard.tabIndex = 0;    addCard.innerHTML = `      <div class="card-inner">        <h2 style="font-size: 3.8em; margin: 0; color: var(--accent-0);">＋</h2>        <p style="margin: 12px 0 4px; color: var(--accent-0); font-size: 1.3em; font-weight: bold;">          Add Section        </p>        <p style="color: #888; font-size: 0.95em;">          ${!hasAnySections ? 'Start building your quiz' : 'Create new MCQ section'}        </p>      </div>    `;    addCard.addEventListener('click', addNewSection);    container.appendChild(addCard);  }  updateSectionCardCounts();}    // --- 5c: Define global variables ---let isTransitioning = false;let revealedCount = 0;let totalAnswers = 0;    let score = 0;    const sectionLuckResults = {  section1: null,  section2: null,  section3: null,  section4: null};    let currentSectionId = null;    let answeredCount = 0;    let totalQuestions = 0;    let animationFrameId;    let hasAutoPlayed = false;// Timer variableslet isTimerRunning = false;let pausedTime = 0;let timeLeft = 1800 * 1000;const totalDuration = timeLeft;let startTime = performance.now();const sectionSchrodingTime = {    section1: null,    section2: null,    section3: null,    section4: null};const sectionTimers = {    section1: 1800 * 1000,    section2: 1800 * 1000,    section3: 1800 * 1000,    section4: 1800 * 1000};const luckUsed = {  section1: false,  section2: false,  section3: false,  section4: false};const sectionAnsweredCount = {  section1: 0,  section2: 0,  section3: 0,  section4: 0};// ==================== EDIT MODE ====================let isEditMode = false;let hasUnsavedChanges = false;// Track modified fields: Map<elementKey, {original: string, element: HTMLElement}>let modifiedFields = new Map();let committedBackup = null;function toggleEditMode() {      isEditMode = !isEditMode;      const btn = document.getElementById('toggle-edit-btn');      const saveBtn = document.getElementById('floating-save-btn');      const luckBtn = document.getElementById('try-my-luck');      if (isEditMode) {        // ENTERING EDIT MODE        modifiedFields.clear();        if (!committedBackup) committedBackup = JSON.parse(JSON.stringify(sections));        btn.textContent = "Exit Edit Mode";        btn.classList.add('active');        document.body.classList.add('edit-mode');        refreshSectionCards();        // FORCE SHOW SAVE BUTTON (JS backup + CSS)        if (saveBtn) saveBtn.style.display = 'block';        enableQuestionEditing();        enableSectionTitleEditing();        enableDragAndDrop();        if (isTimerRunning && currentSectionId) {      pausedTime = performance.now();      isTimerRunning = false;      sectionTimers[currentSectionId] = timeLeft;    }    cancelAnimationFrame(animationFrameId);    if (currentSectionId) {      sectionLuckResults[currentSectionId] = null;      luckUsed[currentSectionId] = false;    }    if (luckBtn) {      luckBtn.disabled = true;      luckBtn.style.cssText = `        opacity: 0.55 !important;        background-color: #333 !important;        color: #888 !important;        border: 3px dashed #ff00ff !important;        box-shadow: none !important;        cursor: not-allowed !important;        pointer-events: none !important;      `;    }    // Setup detection AFTER enabling editing    setTimeout(() => {      setupChangeDetection();      updateRevertButtonState();    }, 50);  } else {    // === EXITING EDIT MODE ===    btn.textContent = "Enable Edit Mode";    btn.classList.remove('active');    document.body.classList.remove('edit-mode');    refreshSectionCards();    // FORCE HIDE SAVE BUTTON    if (saveBtn) saveBtn.style.display = 'none';    if (luckBtn) {      luckBtn.disabled = false;      luckBtn.style.cssText = '';    }    if (currentSectionId && !isTimerRunning) {      isTimerRunning = true;      startTimer();    }    disableQuestionEditing();    disableSectionTitleEditing();    disableDragAndDrop();        hasUnsavedChanges = false;    modifiedFields.clear();	updateTryMyLuckButtonState();  }// Sync settings modal toggle if it's open  syncEditModeToggle();}// Get unique key for an elementfunction getElementKey(el) {  const questionDiv = el.closest('.question');  const questionIndex = questionDiv ?     Array.from(document.querySelectorAll('.question')).indexOf(questionDiv) :     'unknown';    let fieldType = 'unknown';  if (el.tagName === 'P') fieldType = 'question';  else if (el.closest('.explanation')) fieldType = 'explanation';  else if (el.tagName === 'BUTTON' || el.tagName === 'SPAN') fieldType = 'option';  else if (el.closest('.section4-content')) fieldType = 'scenario';    // Add unique identifier within the field type  const siblings = Array.from(questionDiv?.querySelectorAll(`[contenteditable="true"]`) || []);  const fieldIndex = siblings.indexOf(el);    return `${currentSectionId}-q${questionIndex}-${fieldType}-${fieldIndex}`;}// Normalize textfunction normalizeText(text) {  if (!text) return '';  return text.toString()    .replace(/[\s\u00A0\u2000-\u200F\u202F\u205F\u3000\uFEFF]+/g, ' ')    .replace(/&nbsp;/gi, ' ')    .replace(/ +/g, ' ')    .trim();}// Setup comprehensive change detectionfunction setupChangeDetection() {  document.querySelectorAll('[contenteditable="true"]').forEach(el => {    // Track original value on first interaction    let originalValue = null;        const trackAndCheck = () => {      const key = getElementKey(el);      const currentValue = normalizeText(el.innerText || el.textContent);            // If not tracking this field yet, store original      if (!modifiedFields.has(key)) {        if (originalValue === null) {          originalValue = currentValue;        }        // Check if currently different from original        if (currentValue !== originalValue) {          modifiedFields.set(key, {original: originalValue, el: el});          console.log(`Started tracking ${key}: original="${originalValue}", current="${currentValue}"`);        }      } else {        // Already tracking - check if returned to original        const tracked = modifiedFields.get(key);        if (currentValue === tracked.original) {          modifiedFields.delete(key);          console.log(`Field ${key} returned to original, removed from tracking`);        } else {          console.log(`Field ${key} still modified: "${tracked.original}" → "${currentValue}"`);        }      }            updateRevertButtonState();    };        // Use multiple events for reliable detection    el.addEventListener('keydown', (e) => {      // Check on next tick after key is processed      setTimeout(trackAndCheck, 0);    });        el.addEventListener('keyup', () => {      setTimeout(trackAndCheck, 0);    });        el.addEventListener('input', () => {      trackAndCheck();    });        el.addEventListener('blur', () => {      trackAndCheck();    });        // Also check periodically while element is focused    let checkInterval;    el.addEventListener('focus', () => {      originalValue = normalizeText(el.innerText || el.textContent);      checkInterval = setInterval(trackAndCheck, 500);    });        el.addEventListener('blur', () => {      clearInterval(checkInterval);    });  });  window.checkAllFields = checkAllFields;}// Check all currently tracked fields (for cleanup)function checkAllFields() {  const keysToRemove = [];    modifiedFields.forEach((data, key) => {    const el = data.el;    // Check if element still exists    if (!document.body.contains(el)) {      keysToRemove.push(key);      return;    }        const currentValue = normalizeText(el.innerText || el.textContent);    if (currentValue === data.original) {      keysToRemove.push(key);    }  });    keysToRemove.forEach(key => {    modifiedFields.delete(key);    console.log(`Removed ${key} from tracking (returned to original or deleted)`);  });    updateRevertButtonState();}// Update button statefunction updateRevertButtonState() {  const hasChanges = modifiedFields.size > 0;  const revertBtn = document.getElementById('revert-changes-btn');    console.log(`Modified fields: ${modifiedFields.size}`, Array.from(modifiedFields.keys()));    if (revertBtn) {    if (hasChanges) {      revertBtn.classList.remove('no-changes');      revertBtn.style.cssText = '';    } else {      revertBtn.classList.add('no-changes');      revertBtn.style.opacity = '0.55';      revertBtn.style.backgroundColor = '#444';      revertBtn.style.color = '#aaa';      revertBtn.style.border = '3px dashed #ff4444';      revertBtn.style.cursor = 'not-allowed';      revertBtn.style.pointerEvents = 'none';      revertBtn.style.filter = 'grayscale(0.5)';    }  }    hasUnsavedChanges = hasChanges;}function revertChanges() {  if (!currentSectionId || modifiedFields.size === 0) return;  if (confirm("Discard ALL unsaved changes and restore to original state?")) {    if (committedBackup && committedBackup[currentSectionId]) {      sections[currentSectionId] = JSON.parse(JSON.stringify(committedBackup[currentSectionId]));    }        loadSection(currentSectionId);        modifiedFields.clear();        // Re-setup detection for new DOM    setTimeout(() => {      setupChangeDetection();      updateRevertButtonState();    }, 100);    console.log("Changes reverted");  }}function syncSectionsFromDOM() {  if (!currentSectionId) return;    const section = sections[currentSectionId];  if (!section) return;  // Handle MCQ sections (section1, section2, section3)  if (section.questions) {    const questionDivs = document.querySelectorAll('.question');        questionDivs.forEach((qDiv, qIndex) => {      if (qIndex >= section.questions.length) return;            const q = section.questions[qIndex];            // Sync question text      const questionP = qDiv.querySelector('p:first-child');      if (questionP) {        q.question = (questionP.innerText || questionP.textContent).trim();      }            // Sync options and find correct answer      const buttons = qDiv.querySelectorAll('.options-container button, .answer-container button');      const newOptions = [];      let newCorrect = q.correct; // Keep old correct if we can't determine new one            buttons.forEach((btn, optIndex) => {        const text = (btn.innerText || btn.textContent).trim();        newOptions.push(text);                // If this button has the "correct" class, it's the correct answer        if (btn.classList.contains('correct') && !btn.classList.contains('dimmed')) {          newCorrect = text;        }      });            if (newOptions.length > 0) {        q.options = newOptions;        q.correct = newCorrect;      }            // Sync explanation      const expDiv = qDiv.querySelector('.explanation');      if (expDiv) {        q.explanation = (expDiv.innerText || expDiv.textContent).trim();      }    });  }    // Handle Scenario section (section4) - basic HTML content sync  if (currentSectionId === "section4" && section.content) {    const section4Div = document.querySelector('.section4-content');    if (section4Div) {      // Store the modified HTML content      section.content = section4Div.outerHTML;    }  }    console.log(`✅ Synced ${currentSectionId} from DOM to data`);}// ==================== IMPROVED ANTI-BLOAT SAVE (Feb 2026) ====================function saveAsNewFile() {  if (!isEditMode) {    alert("Please enable Edit Mode first.");    return;  }  try {    syncSectionsFromDOM();   // make sure latest edits are in data    const cleanSections = JSON.parse(JSON.stringify(sections));    const cleanTimers = JSON.parse(JSON.stringify(sectionTimers));    const clone = document.documentElement.cloneNode(true);    const body = clone.querySelector('body');    // === CLEAN STATE ===    body.classList.remove('edit-mode', 'keyboard-mode');    clone.querySelector('#settings-modal')?.style.setProperty('display', 'none');    clone.querySelector('#floating-save-btn')?.style.setProperty('display', 'none');    clone.querySelector('#save-success')?.remove();    const toggleBtn = clone.querySelector('#toggle-edit-btn');    if (toggleBtn) {      toggleBtn.textContent = "Enable Edit Mode";      toggleBtn.classList.remove('active');    }    // === REMOVE JUNK ===    clone.querySelectorAll('script[src*="challenge-platform"]').forEach(s => s.remove());    clone.querySelectorAll('script[cf-hash]').forEach(s => s.remove());    // === REPLACE MAIN SCRIPT WITH CLEAN VERSION ===    const mainScript = Array.from(clone.querySelectorAll('script'))      .find(s => s.textContent.includes('quizData') || s.textContent.includes('let sections'));    if (mainScript) {      const cleanScript = `// ==================== CLEAN LIVE DATA - NO LEGACY BLOAT ====================let sections = ${JSON.stringify(cleanSections, null, 2)};const sectionTimers = ${JSON.stringify(cleanTimers, null, 2)};// Legacy compatibility (safe to remove later if you want)const section1Questions = sections.section1 ? sections.section1.questions || [] : [];const section2Questions = sections.section2 ? sections.section2.questions || [] : [];const section3Questions = sections.section3 ? sections.section3.questions || [] : [];const section4Content = sections.section4 ? sections.section4.content || "" : "";// ==================== ALL FUNCTIONS BELOW THIS LINE (unchanged) ====================`;      // Keep everything after the old initialization block      const oldCode = mainScript.textContent;      const keepFrom = oldCode.indexOf('// --- 5c: Define global variables ---') !== -1         ? oldCode.substring(oldCode.indexOf('// --- 5c: Define global variables ---'))         : oldCode.substring(oldCode.indexOf('let isTransitioning') || 0);      mainScript.textContent = cleanScript + "\n\n" + keepFrom;    }    // Force clean homepage view    clone.querySelector('#section-selection').style.display = 'block';    clone.querySelector('#quiz-section').style.display = 'none';    // Generate file    const finalHTML = '<!DOCTYPE html>\n' + clone.outerHTML;    const blob = new Blob([finalHTML], { type: 'text/html' });    const url = URL.createObjectURL(blob);    const a = document.createElement('a');    a.href = url;    a.download = `RSO_Quiz_Clean_${new Date().toISOString().slice(0,10)}.html`;    document.body.appendChild(a);    a.click();    document.body.removeChild(a);    URL.revokeObjectURL(url);    // Success feedback    const successMsg = document.getElementById('save-success');    if (successMsg) {      successMsg.style.display = 'block';      setTimeout(() => successMsg.style.display = 'none', 2800);    }    console.log("✅ Clean save complete — legacy code stripped");  } catch (err) {    console.error("Save error:", err);    alert("Save failed — check F12 console");  }}// Page Title Editingfunction changePageTitle() {  const currentTitle = document.querySelector('#section-selection .header h1').textContent;  const newTitle = prompt("Enter new page title:", currentTitle);    if (newTitle !== null && newTitle.trim() !== "") {    document.querySelector('#section-selection .header h1').textContent = newTitle.trim();    document.title = newTitle.trim() + " - Radiation Protection Quiz";    console.log("Page title updated to:", newTitle);  }}// Section Title Editingfunction enableSectionTitleEditing() {  document.querySelectorAll('.section-card .card-inner h2').forEach(h2 => {    h2.contentEditable = true;    h2.style.outline = "1px dashed #00ffff";  });    const sectionTitle = document.getElementById('section-title');  if (sectionTitle) {    sectionTitle.contentEditable = true;    sectionTitle.style.outline = "1px dashed #00ffff";  }}function disableSectionTitleEditing() {  document.querySelectorAll('.section-card .card-inner h2').forEach(h2 => {    h2.contentEditable = false;    h2.style.outline = "";  });    const sectionTitle = document.getElementById('section-title');  if (sectionTitle) {    sectionTitle.contentEditable = false;    sectionTitle.style.outline = "";  }}// Drag & Drop Reorderingfunction enableDragAndDrop() {  const questions = document.querySelectorAll('.question');    questions.forEach((question, index) => {    question.setAttribute('draggable', true);        question.addEventListener('dragstart', (e) => {      question.classList.add('dragging');      e.dataTransfer.setData('text/plain', index);    });        question.addEventListener('dragend', () => {      question.classList.remove('dragging');      document.querySelectorAll('.question').forEach(q => q.classList.remove('drag-over'));    });        question.addEventListener('dragover', (e) => {      e.preventDefault();      question.classList.add('drag-over');    });        question.addEventListener('dragleave', () => {      question.classList.remove('drag-over');    });        question.addEventListener('drop', (e) => {      e.preventDefault();      question.classList.remove('drag-over');            const fromIndex = parseInt(e.dataTransfer.getData('text/plain'));      const toIndex = Array.from(questions).indexOf(question);            if (fromIndex !== toIndex) {        reorderQuestions(fromIndex, toIndex);      }    });  });}function disableDragAndDrop() {  document.querySelectorAll('.question').forEach(q => {    q.removeAttribute('draggable');        // Remove all drag listeners without cloning (this was the bug!)    q.removeEventListener('dragstart', null);    q.removeEventListener('dragend', null);    q.removeEventListener('dragover', null);    q.removeEventListener('dragleave', null);    q.removeEventListener('drop', null);        q.classList.remove('dragging', 'drag-over');  });}function reorderQuestions(fromIndex, toIndex) {  const currentSection = sections[currentSectionId];  if (!currentSection || !currentSection.questions) return;    const [movedQuestion] = currentSection.questions.splice(fromIndex, 1);  currentSection.questions.splice(toIndex, 0, movedQuestion);    loadSection(currentSectionId);    console.log(`Question moved from position ${fromIndex+1} to ${toIndex+1}`);}// ==================== STEP 3.6: EXPORT / IMPORT TXT (FINAL VERSION) ====================// Export Readable TXT (human-friendly format you requested)function exportReadableTXT() {  // Always use the main quiz title (browser tab title)  let pageTitle = document.title || "Radiation Protection Quiz";  if (pageTitle.includes(' - ')) {    pageTitle = pageTitle.split(' - ').pop().trim();  }  let txt = `${pageTitle.toUpperCase()} - FULL EXPORT\n`;  txt += "=".repeat(pageTitle.length + 20) + "\n\n";  Object.keys(sections).forEach((key, index) => {    const sec = sections[key];        const cleanTitle = sec.title.replace(/^Section \d+:\s*/, '').trim();        txt += `[Section ${index + 1}: ${cleanTitle}]\n`;    txt += `Type: ${sec.type || "MCQ"}\n`;    txt += "=========\n\n";    if (sec.type === "Scenario" || key === "section4") {      // Scenarios - unchanged      if (sec.content) {        const scenarioBlocks = sec.content.split(/<div class="scenario">/i).slice(1);        const separator = " · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · · ·";        scenarioBlocks.forEach((block, i) => {          if (i > 0) txt += separator + "\n\n";          const h2Match = block.match(/<h2>(.*?)<\/h2>/i);          let title = h2Match ? h2Match[1].trim().replace(/^Scenario \d+:\s*/i, '') : `Scenario ${i + 1}`;          const scenarioMatch = block.match(/<strong>Scenario:<\/strong>\s*(.*?)<\/p>/is);          const scenarioText = scenarioMatch ? scenarioMatch[1].trim() : '';          const questionMatch = block.match(/<strong>Question:<\/strong>\s*(.*?)<\/p>/is);          const questionText = questionMatch ? questionMatch[1].trim() : '';          const explanationMatch = block.match(/<strong>Explanation:<\/strong>\s*(.*?)<\/p>/is);          const explanationText = explanationMatch ? explanationMatch[1].trim() : '';          txt += `Scenario ${i + 1}\n`;          txt += `📋 ${title}\n`;          txt += `Scenario: ${scenarioText}\n`;          txt += `Question: ${questionText}\n`;          txt += `Explanation: ${explanationText}\n\n`;        });      }    }     else {      // ==================== MCQ WITH RANDOMIZED OPTIONS ====================      const answerKeys = [];   // collect correct letters after shuffling      sec.questions.forEach((q, i) => {        // Randomize options (fresh shuffle every export)        const shuffled = shuffleOptions(q.options);   // uses your existing shuffle function        const correctIndex = shuffled.indexOf(q.correct);        const correctLetter = String.fromCharCode(97 + correctIndex);        answerKeys.push({ num: i + 1, letter: correctLetter, text: q.correct });        // Print question with randomized options        txt += `${i + 1}. ${q.question}\n`;        shuffled.forEach((opt, j) => {          txt += `   ${String.fromCharCode(97 + j)}. ${opt}\n`;        });        txt += `\n`;      });      // Answer Key - now shows the correct letter AFTER randomization      txt += "ANSWER KEY\n";      txt += "==========\n";      answerKeys.forEach(k => {        txt += `[${k.num}.${k.letter}] ${k.text}\n`;      });    }    // Extra spacing between sections    txt += "\n\n";  });  // Dynamic filename  let fileName = pageTitle    .replace(/[^a-zA-Z0-9\s-]/g, '')    .trim()    .replace(/\s+/g, '_') + "_Full_Export.txt";  const blob = new Blob([txt], { type: 'text/plain' });  const a = document.createElement('a');  a.href = URL.createObjectURL(blob);  a.download = fileName;  a.click();  URL.revokeObjectURL(a.href);}// ==================== FAST JSON EXPORT / IMPORT ====================function exportAsJSON() {  if (!isEditMode) {    alert("Please enable Edit Mode first");    return;  }  const exportData = {    pageTitle: document.querySelector('#section-selection .header h1').textContent.replace(/\s*Sections?$/, '').trim(),    sections: JSON.parse(JSON.stringify(sections)),   // deep copy    sectionTimers: JSON.parse(JSON.stringify(sectionTimers))  };  const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });  const url = URL.createObjectURL(blob);  const a = document.createElement('a');  a.href = url;  a.download = "Radiation_Protection_Quiz_Full.json";  a.click();  URL.revokeObjectURL(url);  alert("✅ JSON exported successfully!\n\nThis contains everything (questions, correct answers, time limits, scenarios, etc.)");}function importJSONFile() {  if (!isEditMode) {    alert("⚠️ Please enable Edit Mode first.");    return;  }  const input = document.createElement('input');  input.type = 'file';  input.accept = '.json';  input.onchange = e => {    const file = e.target.files[0];    if (!file) return;    const reader = new FileReader();    reader.onload = function(event) {      try {        const data = JSON.parse(event.target.result);        if (data.pageTitle) {          const headerH1 = document.querySelector('#section-selection .header h1');          if (headerH1) headerH1.textContent = data.pageTitle + " Sections";          document.title = data.pageTitle + " - Radiation Protection Quiz";        }        let nextNum = Object.keys(sections).length + 1;        Object.keys(data.sections || {}).forEach(oldKey => {          const newKey = `section${nextNum++}`;          sections[newKey] = JSON.parse(JSON.stringify(data.sections[oldKey]));          if (data.sectionTimers && data.sectionTimers[oldKey] !== undefined) {            sectionTimers[newKey] = data.sectionTimers[oldKey];          } else {            sectionTimers[newKey] = 1800 * 1000;          }        });        updateSectionCardCounts();		refreshSectionCards();        alert(`✅ Successfully added ${Object.keys(data.sections || {}).length} new section(s)!`);      } catch (err) {        alert("❌ Invalid JSON file.");        console.error(err);      }    };    reader.readAsText(file);  };  input.click();}// Export HTML Format TXT (for Bulk Add)function exportHTMLFormatTXT() {  let txt = "<!-- Copy and paste this into Bulk Add -->\n\n";    Object.keys(sections).forEach(key => {    const sec = sections[key];    if (sec.questions) {      sec.questions.forEach(q => {        txt += `<div class="question">\n`;        txt += `  <p>${q.question}</p>\n`;        txt += `  <div class="options-container">\n`;        q.options.forEach(opt => {          txt += `    <div class="answer-container"><button>${opt}</button></div>\n`;        });        txt += `  </div>\n`;        if (q.explanation) {          txt += `  <div class="explanation">${q.explanation}</div>\n`;        }        txt += `</div>\n\n*NEW QUESTION*\n\n`;      });    }  });  const blob = new Blob([txt], { type: 'text/plain' });  const a = document.createElement('a');  a.href = URL.createObjectURL(blob);  a.download = "Questions_HTML_Format.txt";  a.click();}// Import TXT readablefunction importTXTFile() {  if (!isEditMode) {    alert("⚠️ Please enable Edit Mode first to import new content.");    return;  }  const input = document.createElement('input');  input.type = 'file';  input.accept = '.txt';  input.onchange = e => {    const file = e.target.files[0];    if (!file) return;    const reader = new FileReader();    reader.onload = function(event) {      parseAndAddSections(event.target.result, file.name);    };    reader.readAsText(file);  };  input.click();}function parseAndAddSections(txtContent, filename = "") {  const lines = txtContent.split('\n');  let i = 0;  // === 1. Extract main page title from first line ===  let mainTitle = lines[0].trim();  mainTitle = mainTitle.replace(/ - FULL EXPORT/i, '').replace(/_/g, ' ').trim();  // Update homepage and browser title  const headerH1 = document.querySelector('#section-selection .header h1');  if (headerH1) headerH1.textContent = mainTitle + " Sections";  document.title = mainTitle + " - Radiation Protection Quiz";  i = 1; // skip header line  let nextSectionNum = Object.keys(sections).length + 1;   // e.g. 5, 6, 7...  while (i < lines.length) {    let line = lines[i].trim();    if (!line) { i++; continue; }    // === New section detected ===    if (line.startsWith('[Section')) {      const titleMatch = line.match(/\[(Section \d+):\s*(.+?)\s*\]/);      if (!titleMatch) { i++; continue; }      const sectionTitle = titleMatch[2].trim();      // Create new section key      const newKey = `section${nextSectionNum++}`;      let sectionType = "MCQ";      let timeLimitMs = 1800 * 1000;   // default 30:00      let questions = [];      i++;      // === Read section metadata ===      while (i < lines.length) {        line = lines[i].trim();        if (!line) { i++; continue; }        if (line.startsWith('Type:')) {          sectionType = line.includes('Scenario') ? "Scenario" : "MCQ";        } else if (line.startsWith('Time Limit:')) {          const timeStr = line.replace('Time Limit:', '').trim();          const [min, sec] = timeStr.split(':').map(Number);          timeLimitMs = ((min * 60) + (sec || 0)) * 1000;        } else if (line.startsWith('=========')) {          break; // end of metadata        }        i++;      }      // === Parse content ===      if (sectionType === "MCQ") {        questions = parseMCQSection(lines, i);        i = questions.nextIndex;   // parser returns next index      } else {        questions = parseScenarioSection(lines, i);        i = questions.nextIndex;      }      // Save the new section      sections[newKey] = {        title: sectionTitle,        type: sectionType,        questions: questions.data || questions   // scenarios return different shape      };      // Store time limit      sectionTimers[newKey] = timeLimitMs;      console.log(`✅ Added ${newKey}: ${sectionTitle} (${sectionType})`);    }    i++;  }  updateSectionCardCounts();  const addedCount = nextSectionNum - 1 - Object.keys(sections).length + 1; // how many we added  alert(`✅ Import successful!\n\nAdded ${addedCount} new section(s)\n\nPage title updated to "${mainTitle}"`);}// ====================== MCQ PARSER ======================function parseMCQSection(lines, startIndex) {  const questions = [];  let i = startIndex;  let currentQ = null;  const answerKey = {};  while (i < lines.length) {    let line = lines[i].trim();    if (!line) { i++; continue; }    if (line.match(/^\d+\./)) {      if (currentQ) questions.push(currentQ);      currentQ = {        question: line.replace(/^\d+\.\s*/, '').trim(),        options: [],        correct: null      };    }     else if (currentQ && line.match(/^[a-d]\./i)) {      const opt = line.replace(/^[a-d]\.\s*/i, '').trim();      currentQ.options.push(opt);    }     else if (line === 'ANSWER KEY') {      i++;      while (i < lines.length && !lines[i].trim().startsWith('[')) {        const ak = lines[i].trim();        const match = ak.match(/\[(\d+)\.([a-d])\]\s*(.*)/i);        if (match) {          const qNum = parseInt(match[1]);          const letter = match[2].toLowerCase();          answerKey[qNum] = letter;        }        i++;      }      continue;    }     else if (line.startsWith('[') || line.startsWith('Scenario')) {      break; // next section    }    i++;  }  // Map correct answers  questions.forEach((q, idx) => {    const correctLetter = answerKey[idx + 1];    if (correctLetter && q.options.length >= 4) {      const letterIndex = correctLetter.charCodeAt(0) - 97; // a=0, b=1...      q.correct = q.options[letterIndex] || q.options[0];    }  });  return { data: questions, nextIndex: i };}// ====================== SCENARIO PARSER ======================function parseScenarioSection(lines, startIndex) {  const scenarios = [];  let i = startIndex;  while (i < lines.length) {    let line = lines[i].trim();    if (line.startsWith('Scenario ') || line.startsWith('📋')) {      const block = [];      while (i < lines.length && !lines[i].trim().startsWith('[') && !lines[i].trim().startsWith('Scenario ') && lines[i].trim() !== '') {        block.push(lines[i]);        i++;      }      const fullBlock = block.join('\n');      // Very simple but effective parser for the format you showed      const titleMatch = fullBlock.match(/📋\s*(.+?)\n/);      const scenarioMatch = fullBlock.match(/Scenario:\s*(.+?)(?=Question:|$)/s);      const questionMatch = fullBlock.match(/Question:\s*(.+?)(?=Explanation:|$)/s);      const explMatch = fullBlock.match(/Explanation:\s*(.+?)(?=\n· · ·|$)/s);      scenarios.push({        scenario: (scenarioMatch ? scenarioMatch[1] : "").trim(),        question: (questionMatch ? questionMatch[1] : "").trim(),        explanation: (explMatch ? explMatch[1] : "").trim()      });      continue;    }    if (line.startsWith('[')) break;    i++;  }  return { data: scenarios, nextIndex: i };}// Real parser for your readable TXT formatfunction parseAndReplaceAll(txtContent) {  try {    const lines = txtContent.split('\n');    let newSections = {};    let currentKey = null;    let currentQuestions = [];    let isScenario = false;    for (let line of lines) {      line = line.trim();      if (!line) continue;      if (line.startsWith('[Section')) {        if (currentKey) {          newSections[currentKey] = {            title: currentKey,            type: isScenario ? "Scenario" : "MCQ",            questions: currentQuestions          };        }        currentQuestions = [];        currentKey = `section${Object.keys(newSections).length + 1}`;        isScenario = false;      }       else if (line.startsWith('Type:')) {        if (line.includes('Scenario')) isScenario = true;      }       else if (line.match(/^\d+\./)) {        currentQuestions.push({          question: line.replace(/^\d+\.\s*/, ''),          options: [],          correct: null,          explanation: ""        });      }       else if (line.match(/^[a-d]\./i)) {        if (currentQuestions.length > 0) {          currentQuestions[currentQuestions.length-1].options.push(            line.replace(/^[a-d]\.\s*/i, '')          );        }      }       else if (line.startsWith('Answer:')) {        if (currentQuestions.length > 0) {          currentQuestions[currentQuestions.length-1].explanation = line.replace(/^Answer:\s*/, '');        }      }    }    // Save last section    if (currentKey) {      newSections[currentKey] = {        title: currentKey,        type: isScenario ? "Scenario" : "MCQ",        questions: currentQuestions      };    }    // Replace everything    sections = newSections;        if (currentSectionId) loadSection(currentSectionId);    updateSectionCardCounts();    alert("✅ Import successful! All sections replaced.");  } catch (err) {    alert("❌ Import failed. Please check the TXT format.");    console.error(err);  }}// ==================== END OF STEP 3.6 ====================// ==================== FINAL enableQuestionEditing & disableQuestionEditing (Step 3.2 Fixed) ====================function enableQuestionEditing() {  document.querySelectorAll('.question').forEach(qDiv => {    qDiv.classList.add('edit-mode');        const questionP = qDiv.querySelector('p:first-child');    if (questionP) {      questionP.contentEditable = true;      questionP.style.outline = "1px dashed #00ffff";    }        const buttons = qDiv.querySelectorAll('button');    buttons.forEach(btn => {      if (btn.closest('.question-edit-toolbar')) return;            const span = btn.querySelector('span') || btn;      span.contentEditable = true;      span.style.outline = "1px dashed #00ffff";    });        const expDiv = qDiv.querySelector('.explanation');    if (expDiv) {      expDiv.style.display = 'block';      expDiv.contentEditable = true;      expDiv.style.outline = "1px dashed #00ffff";    }        if (!qDiv.querySelector('.question-edit-toolbar')) {      const toolbar = document.createElement('div');      toolbar.className = 'question-edit-toolbar';      toolbar.innerHTML = `        <button onclick="deleteCurrentQuestion(this); setTimeout(syncSectionsFromDOM, 50); setTimeout(checkForChanges, 100);">🗑 Delete Question</button>        <button onclick="addNewOption(this); setTimeout(syncSectionsFromDOM, 50); setTimeout(checkForChanges, 100);">+ Add Option</button>      `;      qDiv.appendChild(toolbar);    }  });}function disableQuestionEditing() {  document.querySelectorAll('.question').forEach(qDiv => {    qDiv.classList.remove('edit-mode');        const questionP = qDiv.querySelector('p:first-child');    if (questionP) {      questionP.contentEditable = false;      questionP.style.outline = "";    }        const buttons = qDiv.querySelectorAll('button');    buttons.forEach(btn => {      const span = btn.querySelector('span') || btn;      span.contentEditable = false;      span.style.outline = "";    });        const expDiv = qDiv.querySelector('.explanation');    if (expDiv) {      expDiv.contentEditable = false;      expDiv.style.outline = "";    }        const toolbar = qDiv.querySelector('.question-edit-toolbar');    if (toolbar) toolbar.remove();  });}// ==================== END OF FIXED EDITING FUNCTIONS ====================// Helper functions (will be expanded later)function deleteCurrentQuestion(btn) {  if (confirm("Delete this question permanently?")) {    btn.closest('.question').remove();    updateSectionCardCounts();  }}function addNewOption(btn) {  // Simple add for now - will improve in next step  alert("Add new option feature coming in Step 3.3");}function cardClick(cardElement, sectionId) {  cardElement.classList.remove('colorize');  cardElement.classList.remove('decolorize');   void cardElement.offsetWidth; // Force reflow to reset animation  cardElement.classList.add('colorize');    if (sectionId === currentSectionId && quizSectionEl.style.display === "block") {    return;  }    if (sectionId === currentSectionId && quizSectionEl.style.display === "none") {    quizSectionEl.style.display = "block";    sectionSelectionEl.style.display = "none";        // Check if this section is completed using section-specific counter    const isCompleted = sectionId.startsWith('section') &&       sections[sectionId] &&       ((sectionId !== "section4" && sectionAnsweredCount[sectionId] >= sections[sectionId].questions.length) ||       (sectionId === "section4" && revealedCount >= document.querySelectorAll('.section4-content .answer-wrapper').length));        // If section is completed, don't restart the timer    if (isCompleted) {      // Just show the results without starting the timer      cancelAnimationFrame(animationFrameId);      isTimerRunning = false;      // Update the display with the saved time      updateTimerDisplay(sectionTimers[sectionId] || 0);    } else {      // Use the stored time for this section instead of resetting      timeLeft = sectionTimers[sectionId] || 1800 * 1000;      // Set pausedTime to now so we can calculate the pause offset      pausedTime = performance.now();      isTimerRunning = false; // Mark as paused before starting            // CRITICAL FIX: Reset the schrodinger time to null to get moving digits again      if (!isCompleted) {        sectionSchrodingTime[currentSectionId] = null;      }            startTimer(); // Resume the timer with the correct time    }    return;  }    setTimeout(() => {    loadSection(sectionId);  }, 450);}// Event listeners attacheddocument.querySelectorAll('.section-card').forEach(card => {  card.addEventListener('click', function() {    const sectionId = this.dataset.section;    cardClick(this, sectionId);  });});updateSectionCardCounts();// Global exposurewindow.cardClick = cardClick;    // --- 5d: Cache DOM elements ---    const sectionSelectionEl = document.getElementById("section-selection");    const scoreBoardEl = document.getElementById("scoreBoard");    const quizSectionEl = document.getElementById("quiz-section");    const quizEl = document.getElementById("quiz");    const correctAnswersEl = document.getElementById("correctAnswers");    const totalQuestionsEl = document.getElementById("totalQuestions");    const progressBarEl = document.getElementById("progressBar");    const timerEl = document.getElementById("time");    const sectionTitleEl = document.getElementById("section-title");	function shuffleOptions(options) {  let shuffled = options.slice();  for (let i = shuffled.length - 1; i > 0; i--) {    const j = Math.floor(Math.random() * (i + 1));    [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];  }  return shuffled;}function handleAnswer(button, selectedOption, correctAnswer, questionDiv, explanation) {  // Prevent answering while in Edit Mode  if (isEditMode) return;  if (questionDiv.getAttribute("data-answered") === "true") return;  questionDiv.setAttribute("data-answered", "true");  answeredCount++;  sectionAnsweredCount[currentSectionId]++;  const isCorrect = selectedOption === correctAnswer;  if (isCorrect) score++;  // Disable all buttons  const buttons = questionDiv.querySelectorAll("button");  buttons.forEach(btn => btn.disabled = true);  // Style selected button (Exam 6 style)  button.classList.add(isCorrect ? "correct" : "incorrect");  if (!isCorrect) {    buttons.forEach(btn => {      if (btn.textContent === correctAnswer) btn.classList.add("correct");    });  }// Dim all non-selected AND non-correct buttonsbuttons.forEach(btn => {  if (btn !== button && !btn.classList.contains("correct")) {    btn.classList.add("dimmed");  }});  // Status icon  const statusIcon = document.createElement("span");  statusIcon.className = `status-icon ${isCorrect ? "correct" : "incorrect"}`;  statusIcon.textContent = isCorrect ? "✔" : "✖";  button.parentElement.appendChild(statusIcon);  // Update score  correctAnswersEl.textContent = score;  // Explanation (if exists)  const expDiv = questionDiv.querySelector(".explanation");  if (expDiv && explanation) expDiv.style.display = 'block';  // Progress & reward (keep your original logic)  progressBarEl.style.width = `${(answeredCount / totalQuestions) * 100}%`;  const progressPercent = Math.round((answeredCount / totalQuestions) * 100);  const sectionProgressBar = document.querySelector(`.section-card[data-section="${currentSectionId}"] .section-progress .progress-bar`);  if (sectionProgressBar) sectionProgressBar.style.width = progressPercent + "%";  if (answeredCount === totalQuestions && score / totalQuestions >= 0.9) {    scoreBoardEl.classList.add("reward");  }}    // --- 5e: Define the loadSection function ---    function loadSection(sectionId) { // Remove all section-active classes first  document.body.classList.remove('section1-active', 'section2-active', 'section3-active', 'section4-active');   // Add the current section's class  document.body.classList.add(`${sectionId}-active`);  // IMPORTANT: Cancel any existing timer before switching sections  if (animationFrameId) {    cancelAnimationFrame(animationFrameId);    animationFrameId = null;  }          currentSectionId = sectionId;  // === Auto-play Suno ONLY on the very first section click (user has never manually played before) ===  if (!hasAutoPlayed) {    triggerInstantPlay();  }  // Restore Edit Mode state when entering a section  if (isEditMode) {    document.body.classList.add('edit-mode');  }  // Make the quiz section visible and hide section selection  quizSectionEl.style.display = "block";  sectionSelectionEl.style.display = "none";  enableQuestionEditing();  // --- Section 4 Branch ---  if (sectionId === "section4") {    sectionTitleEl.textContent = "Section 4: Radiation Safety Scenarios";    document.title = "Section 4: Radiation Safety Scenarios - Radiation Protection Quiz";    document.getElementById("score-timer-container").style.display = "flex";    document.getElementById("progress-container").style.display = "block";        // Load Section 4 content    quizEl.innerHTML = section4Content;        const totalAnswers = document.querySelectorAll('.section4-content .answer-wrapper').length;    totalQuestionsEl.textContent = totalAnswers;        // Check if Section 4 is completed using revealedCount     const isCompleted = revealedCount >= totalAnswers;         // Reset progress for Section 4 if not completed    if (!isCompleted) {      revealedCount = 0;      correctAnswersEl.textContent = "0";      progressBarEl.style.width = "0%";    }        // Use saved time for this section    timeLeft = sectionTimers[sectionId] || 1800 * 1000;    updateTimerDisplay(timeLeft);    // Only start timer if section is not completed    if (isCompleted) {      // Just update display without starting timer      updateTimerDisplay(timeLeft);      isTimerRunning = false;    } else {      // CRITICAL FIX: Ensure proper pause time handling      pausedTime = performance.now();      isTimerRunning = false; // Start paused      startTime = performance.now() - (1800 * 1000 - timeLeft);      startTimer(); // This will handle the pause offset    }        return;  }    // Logic for sections 1-3  if (!sections[sectionId]) {    console.error("Section not found:", sectionId);    return;  }    const section = sections[sectionId];    // Check if this section is completed using section-specific counters  const isCompleted = sectionAnsweredCount[sectionId] >= section.questions.length;    // Reset quiz state if not completed  if (!isCompleted) {    score = 0;    answeredCount = 0;    totalQuestions = section.questions.length;    correctAnswersEl.textContent = "0";    totalQuestionsEl.textContent = totalQuestions;    progressBarEl.style.width = "0%";  } else {    // Keep existing values for completed sections    answeredCount = sectionAnsweredCount[sectionId]; // Use the section's stored value     totalQuestions = section.questions.length;    totalQuestionsEl.textContent = totalQuestions;    correctAnswersEl.textContent = score; // Display the correct score  }    sectionTitleEl.textContent = section.title;  document.title = section.title + " - Radiation Protection Quiz";  sectionTitleEl.style.textAlign = "center";  quizEl.innerHTML = "";    // Use saved time for this section  timeLeft = sectionTimers[sectionId] || 1800 * 1000;  updateTimerDisplay(timeLeft);  // Only start timer if section is not completed  if (isCompleted) {    // Just update display without starting timer    updateTimerDisplay(timeLeft);    isTimerRunning = false;  } else {    // CRITICAL FIX: Ensure proper pause time handling  pausedTime = performance.now();  isTimerRunning = false;  if (!isEditMode) {    sectionSchrodingTime[sectionId] = null;  }  startTime = performance.now() - (1800 * 1000 - timeLeft);  startTimer();}     // Show score/timer for interactive quiz sections  document.getElementById("score-timer-container").style.display = "flex";  document.getElementById("progress-container").style.display = "block";    // Render questions – Exam 6 UI structure (options-container + handleAnswer)section.questions.forEach(q => {  const qDiv = document.createElement("div");  qDiv.className = "question";  const questionP = document.createElement("p");  questionP.textContent = q.question;  qDiv.appendChild(questionP);  // Smart shuffle with special handling (kept exactly as you had it)  let lastOptions = ["None of the above", "All of the above"];  let specialThird = "Both";  let options = q.options.map(opt => opt === "Neither" ? "None of the above" : opt);  let noneOrAll = options.find(opt => lastOptions.includes(opt));  let both = options.find(opt => opt === specialThird);  options = options.filter(opt => opt !== noneOrAll && opt !== both);  options = options    .map(opt => ({ value: opt, sort: Math.random() }))    .sort((a, b) => a.sort - b.sort)    .map(obj => obj.value);  if (both) options.splice(2, 0, both);  if (noneOrAll) options.push(noneOrAll);  // New: options container  const optionsContainer = document.createElement("div");  optionsContainer.className = "options-container";  options.forEach(option => {    const answerContainer = document.createElement("div");    answerContainer.className = "answer-container";    const btn = document.createElement("button");    btn.textContent = option;    btn.onclick = () => handleAnswer(btn, option, q.correct, qDiv, q.explanation);    answerContainer.appendChild(btn);    optionsContainer.appendChild(answerContainer);  });  qDiv.appendChild(optionsContainer);  // Feedback  const fbDiv = document.createElement("div");  fbDiv.className = "feedback";  fbDiv.style.display = "none";  qDiv.appendChild(fbDiv);  // Explanation (if the question has one)  if (q.explanation) {    const expDiv = document.createElement("div");    expDiv.className = "explanation";    expDiv.innerHTML = q.explanation;    expDiv.style.display = "none";    qDiv.appendChild(expDiv);  }  quizEl.appendChild(qDiv);});updateTryMyLuckButtonState();}     window.loadSection = loadSection;    window.tryMyLuck = tryMyLuck;document.addEventListener('click', (e) => {  const wrapper = e.target.closest('.answer-wrapper');  if (wrapper) {    wrapper.classList.toggle('blurred');        if (currentSectionId === "section4" &&        !wrapper.classList.contains('blurred') &&        wrapper.getAttribute('data-revealed') !== "true") {            wrapper.setAttribute('data-revealed', 'true');      revealedCount++;      const totalAnswers = document.querySelectorAll('.section4-content .answer-wrapper').length;      progressBarEl.style.width = `${(revealedCount / totalAnswers) * 100}%`;      correctAnswersEl.textContent = revealedCount;            // Add this block to save the timer when all scenarios are revealed      if (revealedCount >= totalAnswers) {        // Save the current timer's random milliseconds        if (sectionSchrodingTime[currentSectionId] === null) {          const currentDisplay = timerEl.textContent;          sectionSchrodingTime[currentSectionId] = currentDisplay.slice(-2);        }                // Stop the timer animation        cancelAnimationFrame(animationFrameId);        isTimerRunning = false;      }    }  }});function closePopup() {  const popup = document.querySelector('.luck-result');  const overlay = document.querySelector('.luck-overlay');  if (popup) popup.remove();  if (overlay) overlay.remove();  resetKeyboardMode();}function tryMyLuck() {if (isEditMode) return;  // Check if we have a previous result for this section  const sectionResult = sectionLuckResults[currentSectionId];    // If a result exists, just show it again  if (sectionResult) {    showLuckResult(sectionResult);    return;  }  // If no result exists, proceed with the random answer selection  if (answeredCount >= totalQuestions) {    alert("All questions have already been answered!");    return;  }  // Find all unanswered questions  const unansweredQuestions = Array.from(document.querySelectorAll('.question'))    .filter(q => q.getAttribute('data-answered') !== "true");  let correctCount = 0;  let totalAttempted = 0;  unansweredQuestions.forEach(q => {    const buttons = q.querySelectorAll('button');    if (buttons.length === 0) return;    const randomIndex = Math.floor(Math.random() * buttons.length);    const selectedButton = buttons[randomIndex];    selectedButton.setAttribute('data-lucky', 'true');    selectedButton.click();    totalAttempted++;    selectedButton.style.backgroundColor = "#ff00ff";    selectedButton.style.color = "#0d0d0d";    selectedButton.style.borderColor = "#000000";    selectedButton.style.borderWidth = "2px";     selectedButton.style.borderStyle = "solid";    selectedButton.classList.add('lucky-selected');        const statusIcon = q.querySelector('.status-icon');    if (statusIcon) {      statusIcon.style.color = "#ff00ff";      statusIcon.style.textShadow = "0 0 1px #000000, 0 0 1px #000000";    }    const answerPopup = q.querySelector('.answer-popup');    if (answerPopup) {      answerPopup.style.color = "#ff00ff";      answerPopup.style.borderColor = "#ff00ff";      answerPopup.style.boxShadow = "0 0 10px rgba(var(--accent-0-rgb), 0.5)";            const coloredSpans = answerPopup.querySelectorAll('span[style*="color"]');      coloredSpans.forEach(span => {        span.style.color = "#ff00ff";      });    }    const answerContainer = selectedButton.closest('.answer-container');    if (answerContainer) {      const containerIcons = answerContainer.querySelectorAll('.status-icon');      containerIcons.forEach(icon => {        icon.style.color = "#ff00ff";        icon.style.textShadow = "0 0 1px #000000, 0 0 1px #000000";      });    }    if (statusIcon && statusIcon.textContent === "✔") {      correctCount++;    }  });  if (!document.getElementById('lucky-styles')) {    const styleElement = document.createElement('style');    styleElement.id = 'lucky-styles';    styleElement.textContent = `      .lucky-selected {  background-color: #c300c3 !important;     /* same darker magenta as button */  color: #f0e0f0 !important;                /* light text for readability */  border-color: #000000 !important;  border-width: 2px;  border-style: solid;}.lucky-selected:hover {  background-color: #a500a5 !important;  box-shadow: 0 0 15px rgba(165, 0, 165, 0.8) !important;  border-color: #000000 !important;}    `;    document.head.appendChild(styleElement);  }  const percentage = Math.round((correctCount / totalAttempted) * 100);  let message = `Your luck answered ${totalAttempted} questions!\n`;  message += `You got ${correctCount} correct (${percentage}%).\n\n`;  if (percentage === 100) {    message += "Perfect score! Are you cheating? 😉";  } else if (percentage >= 80) {    message += "Incredible luck! You should buy a lottery ticket!";  } else if (percentage >= 60) {    message += "Pretty good luck! Better than flipping a coin!";  } else if (percentage >= 40) {    message += "Not bad! About what you'd expect from random chance.";  } else {    message += "Ouch... maybe don't rely on luck next time!";  }  // Store section-specific result  sectionLuckResults[currentSectionId] = {    totalAttempted,    correctCount,     percentage,    message  };  luckUsed[currentSectionId] = true;  // Update button state  const tryMyLuckButton = document.getElementById('try-my-luck');if (tryMyLuckButton) {  // Only clear these if NOT in edit mode  if (!document.body.classList.contains('edit-mode')) {    tryMyLuckButton.style.borderColor = "";    tryMyLuckButton.style.borderWidth = "";    tryMyLuckButton.style.borderStyle = "";  }  tryMyLuckButton.removeAttribute('data-lucky-used');}  // Show the result  showLuckResult(sectionLuckResults[currentSectionId]);// === CORRECT PLACE: Grey out the button after luck has been used ===  if (tryMyLuckButton) {    tryMyLuckButton.classList.add('luck-used');  }}function updateTryMyLuckButtonState() {  const btn = document.getElementById('try-my-luck');  if (!btn) return;  const isUsed = luckUsed[currentSectionId] === true;  if (isUsed) {    btn.classList.add('luck-used');  } else {    btn.classList.remove('luck-used');  }}function showLuckResult(result) {  // Remove any existing popups first  const existingPopups = document.querySelectorAll('.luck-result');  existingPopups.forEach(popup => popup.remove());    // Remove any existing overlays  const existingOverlays = document.querySelectorAll('.luck-overlay');  existingOverlays.forEach(overlay => overlay.remove());  // Create and show the result popup  const resultPopup = document.createElement('div');  resultPopup.className = 'luck-result';  resultPopup.innerHTML = `    <h2>Your Luck Results</h2>    <p>${result.message.replace(/\n/g, '<br>')}</p>    <button class="close-popup">Close</button>  `;  document.body.appendChild(resultPopup);  // Add an overlay behind the popup  const overlay = document.createElement('div');  overlay.className = 'luck-overlay';  overlay.style.cssText = 'position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:999;';  document.body.insertBefore(overlay, resultPopup);    // Function to close the popup and clean up event listeners  const closePopup = () => {    resultPopup.remove();    overlay.remove();    document.removeEventListener('click', handleOutsideClick);    document.removeEventListener('keydown', handleEscapeKey);  };// Close button click handler  const closeButton = resultPopup.querySelector('.close-popup');  closeButton.addEventListener('click', closePopup);  // Handle clicks outside the popup  const handleOutsideClick = (event) => {    // Check if the click is outside the popup    if (!resultPopup.contains(event.target) && event.target !== resultPopup) {      closePopup();    }  };// Handle escape key  const handleEscapeKey = (event) => {    if (event.key === 'Escape') {      closePopup();    }  };  // Add event listeners for outside clicks and escape key  setTimeout(() => {    document.addEventListener('click', handleOutsideClick);    document.addEventListener('keydown', handleEscapeKey);  }, 100);}function handleSectionClick(sectionId) {  // 0. Prevent rapid double-clicks during transition  if (isTransitioning) return;  isTransitioning = true;    // 1. Freeze UI updates temporarily  cancelAnimationFrame(animationFrameId);    // 2. Atomic UI update (all changes in one frame)  requestAnimationFrame(() => {    // Visual reset    document.querySelectorAll('.section-card').forEach(card => {      card.classList.remove('colorize');      card.classList.add('decolorize');    });        // Update current section    currentSectionId = sectionId;    const currentCard = document.querySelector(`.section-card[data-section="${sectionId}"]`);    if (currentCard) {      currentCard.classList.add('colorize');      currentCard.classList.remove('decolorize');    }        // View switch    sectionSelectionEl.style.display = "none";    quizSectionEl.style.display = "block";    document.title = `Section ${sectionId.slice(-1)} - Radiation Protection Quiz`;        // 3. Restart timer AFTER UI is fully updated    timeLeft = sectionTimers[sectionId] || 1800 * 1000;    startTimer();        // 4. Release the lock    isTransitioning = false;  });}// UPDATED: Modified startTimer functionfunction startTimer() {if (isEditMode) {    isTimerRunning = false;    return;  }    // Use section-specific schrodinger time - but only if section is completed!    // Check if section is completed    const isCompleted = currentSectionId && ((        currentSectionId !== "section4" &&         sections[currentSectionId] &&         sectionAnsweredCount[currentSectionId] >= sections[currentSectionId].questions.length      ) || (        currentSectionId === "section4" &&         revealedCount >= document.querySelectorAll('.section4-content .answer-wrapper').length      ));        // Only use saved Schrodinger time if the section is completed    if (isCompleted) {        if (sectionSchrodingTime[currentSectionId] === null ||             sectionSchrodingTime[currentSectionId] === undefined) {            sectionSchrodingTime[currentSectionId] = Math.floor(Math.random() * 100).toString().padStart(2, '0');        }    } else {        // Reset Schrodinger time for active sections        sectionSchrodingTime[currentSectionId] = null;    }        // CRITICAL FIX: Calculate offset if resuming from pause    const timeElapsedDuringPause = isTimerRunning ? 0 : performance.now() - pausedTime;        // Set our start time accounting for: total duration, remaining time, and pause offset    startTime = performance.now() - (totalDuration - timeLeft) - timeElapsedDuringPause;        isTimerRunning = true;    updateTimerDisplay(timeLeft);    updateSectionTimer(currentSectionId, timeLeft);    let lastUpdate = performance.now();      function frameUpdate(timestamp) {    // Only update every ~16ms (60fps)    if (timestamp - lastUpdate >= 16) {        // Check if all questions/scenarios are answered based on section type        const allAnswered =             (currentSectionId !== "section4" && answeredCount >= totalQuestions) ||             (currentSectionId === "section4" &&             revealedCount >= document.querySelectorAll('.section4-content .answer-wrapper').length);                if (allAnswered) {            // Save the last two digits if not already saved            if (sectionSchrodingTime[currentSectionId] === null) {                const currentDisplay = timerEl.textContent;                sectionSchrodingTime[currentSectionId] = currentDisplay.slice(-2);            }                         // IMPORTANT: Properly clean up animation            cancelAnimationFrame(animationFrameId);            animationFrameId = null;            isTimerRunning = false;            updateSectionTimer(currentSectionId, timeLeft);            return;        }                timeLeft = Math.max(0, totalDuration - (timestamp - startTime));                updateTimerDisplay(timeLeft);        updateSectionTimer(currentSectionId, timeLeft);        lastUpdate = timestamp;                if (timeLeft <= 0) {            // Save the last two digits if not already saved            if (sectionSchrodingTime[currentSectionId] === null) {                const currentDisplay = timerEl.textContent;                sectionSchrodingTime[currentSectionId] = currentDisplay.slice(-2);            }                        if (typeof handleTimeExpired === 'function') {                handleTimeExpired(currentSectionId);            }            // IMPORTANT: Properly clean up animation            cancelAnimationFrame(animationFrameId);            animationFrameId = null;            return;        }    }    animationFrameId = requestAnimationFrame(frameUpdate);}    animationFrameId = requestAnimationFrame(frameUpdate);}// UPDATED: Modified updateTimerDisplay functionfunction updateTimerDisplay(remainingMs) {    const base = (remainingMs / 1000).toFixed(3);   // e.g. "1800.000"    let suffix = "00";    if (currentSectionId &&         sectionSchrodingTime[currentSectionId] !== null &&         sectionSchrodingTime[currentSectionId] !== undefined) {                // Use saved frozen Schrodinger digits (works in Edit Mode too)        suffix = sectionSchrodingTime[currentSectionId];            } else if (!isEditMode && isTimerRunning) {        // Only randomize when timer is actually running        suffix = Math.floor(Math.random() * 100).toString().padStart(2, '0');    }    // else: fresh section in Edit Mode stays "00" → 1800.00000    timerEl.textContent = base + suffix;}// Time formatting function// Converts milliseconds to a formatted MM:SS stringfunction formatTimeMinSec(ms) {  // Convert total milliseconds to seconds  let totalSeconds = Math.floor(ms / 1000);    // Calculate minutes and remaining seconds  let minutes = Math.floor(totalSeconds / 60);  let seconds = totalSeconds % 60;    // Add leading zeros for consistent formatting  return `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;}function resetTimer() {  // Reset section-specific Schrodinger time  sectionSchrodingTime[currentSectionId] = null;    // Cancel any ongoing animation frame  cancelAnimationFrame(animationFrameId);    // Reset timer state variables  timeLeft = 1800 * 1000;  sectionTimers[currentSectionId] = timeLeft;  pausedTime = performance.now();  isTimerRunning = true;    startTime = performance.now();    // Update visual display  updateTimerDisplay(timeLeft);  timerEl.classList.add('reset-flash');  setTimeout(() => {    timerEl.classList.remove('reset-flash');  }, 300);    // Restart the timer with fresh state  startTimer();}function updateSectionTimer(sectionId, remainingMs) {    // Select the timer element within the specified section card    const timerEl = document.querySelector(`.section-card[data-section="${sectionId}"] .section-timer`);        if (timerEl) {        // Determine if the section is completed based on answered questions        const allAnswered = (answeredCount >= totalQuestions && currentSectionId !== "section4") ||                           (currentSectionId === "section4" && revealedCount >= totalAnswers);                if (allAnswered) {            // For completed sections, display the time it took to complete            const elapsedMs = 1800 * 1000 - remainingMs;            timerEl.textContent = "Completed in " + formatTimeMinSec(elapsedMs);        } else {            // For active sections, display the remaining time            timerEl.textContent = "Time left: " + formatTimeMinSec(remainingMs);            // Store the current time for this section            sectionTimers[sectionId] = remainingMs;        }    }}function resetSection4Progress() {  revealedCount = 0;  progressBarEl.style.width = "0%";  correctAnswersEl.textContent = "0";  const wrappers = document.querySelectorAll('.section4-content .answer-wrapper');  wrappers.forEach(wrapper => {    if (!wrapper.classList.contains("blurred")) {      wrapper.classList.add("blurred");    }    wrapper.removeAttribute("data-revealed");  });}// 5. Ensure restart function clears section-specific value:function restartQuiz() {    if (!currentSectionId) return;    sectionAnsweredCount[currentSectionId] = 0;    sectionLuckResults[currentSectionId] = null;    luckUsed[currentSectionId] = false;	updateTryMyLuckButtonState();    // Reset section-specific schrodinger time    sectionSchrodingTime[currentSectionId] = null;        const luckPopup = document.querySelector('.luck-result');    const luckOverlay = document.querySelector('.luck-overlay');    if (luckPopup) luckPopup.remove();    if (luckOverlay) luckOverlay.remove();   const tryMyLuckButton = document.getElementById('try-my-luck');  if (tryMyLuckButton && !isEditMode) {    tryMyLuckButton.style.borderColor = "";    tryMyLuckButton.style.borderWidth = "";    tryMyLuckButton.style.borderStyle = "";    tryMyLuckButton.removeAttribute('data-lucky-used');  }  score = 0;  answeredCount = 0;  correctAnswersEl.textContent = "0";  progressBarEl.style.width = "0%";  const sectionProgressBar = document.querySelector(`.section-card[data-section="${currentSectionId}"] .section-progress .progress-bar`);  if (sectionProgressBar) {    sectionProgressBar.style.width = "0%";  }  sectionTimers[currentSectionId] = 1800 * 1000;  if (currentSectionId === "section4") {    resetSection4Progress();      const luckyButtons = document.querySelectorAll('button[data-lucky="true"]');    luckyButtons.forEach(button => {      button.style.backgroundColor = "";      button.style.color = "";      button.style.borderColor = "";      button.style.borderWidth = "";      button.style.borderStyle = "";      button.classList.remove('lucky-selected');      button.removeAttribute('data-lucky');    });    const luckPopups = document.querySelectorAll('.answer-popup[style*="border-color: rgb(255, 0, 255)"]');    luckPopups.forEach(popup => {      popup.style.color = "#00ffff";      popup.style.borderColor = "#00ffff";      popup.style.boxShadow = "";    });    const luckIcons = document.querySelectorAll('.status-icon[style*="color: rgb(255, 0, 255)"]');    luckIcons.forEach(icon => {      icon.style.color = "#00ffff";      icon.style.textShadow = "";    });    resetTimer();    return;  }   loadSection(currentSectionId);  scoreBoardEl.classList.remove("reward");}window.restartQuiz = restartQuiz;function backToSections() {// CRITICAL: Force cancel any active animation frame first    if (animationFrameId) {        cancelAnimationFrame(animationFrameId);        animationFrameId = null; // Explicitly null out the ID    }    // Save the random digits if they haven't been saved yet    if (sectionSchrodingTime[currentSectionId] === null) {        const currentDisplay = timerEl.textContent;        sectionSchrodingTime[currentSectionId] = currentDisplay.slice(-2);    }    // IMPORTANT: Ensure timer is marked as stopped    isTimerRunning = false;// Store exact time at pause point    if (currentSectionId) {        sectionTimers[currentSectionId] = timeLeft;        pausedTime = performance.now(); // Record exact pause time    }    // Visual transition effects    const currentCard = document.querySelector(`.section-card[data-section="${currentSectionId}"]`);    if (currentCard) {        currentCard.classList.add('decolorize');        currentCard.classList.remove('colorize');    }    // Update the section card's timer display    updateSectionTimer(currentSectionId, timeLeft);    // UI updates    sectionSelectionEl.style.display = "block";    quizSectionEl.style.display = "none";    document.title = "Radiation Protection Quiz";     // Clean up animations    setTimeout(() => {        document.querySelectorAll('.section-card').forEach(card => {            card.classList.remove('colorize');            card.classList.remove('decolorize');        });    }, 450);}window.backToSections = backToSections;// Keyboard Navigation Code (fixed version)let focusedElementIndex = -1;let keyboardMode = false;let previousActiveElement = null;document.addEventListener('keydown', function(e) {  if (e.key === 'Escape') {    const luckPopup = document.querySelector('.luck-result');    if (luckPopup) {      closePopup();      return;    }    if (quizSectionEl.style.display === 'block') {      backToSections();      return;    }  }    if (['Tab', 'ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'Enter'].includes(e.key)) {    keyboardMode = true;    document.body.classList.add('keyboard-mode');    e.preventDefault();        let interactiveElements = getInteractiveElements();    if (interactiveElements.length > 0) {      if (previousActiveElement) {        cleanFocusStyles(previousActiveElement);      }            switch(e.key) {        case 'ArrowUp':        case 'ArrowLeft':          focusedElementIndex = focusedElementIndex <= 0             ? interactiveElements.length - 1             : focusedElementIndex - 1;          break;        case 'ArrowDown':        case 'ArrowRight':          focusedElementIndex = (focusedElementIndex + 1) % interactiveElements.length;          break;           case 'Tab':          if (e.shiftKey) {            focusedElementIndex = focusedElementIndex <= 0               ? interactiveElements.length - 1               : focusedElementIndex - 1;          } else {            focusedElementIndex = (focusedElementIndex + 1) % interactiveElements.length;          }          break;        default:          break;      }            focusedElementIndex = Math.max(0, Math.min(focusedElementIndex, interactiveElements.length - 1));      const currentElement = interactiveElements[focusedElementIndex];      currentElement.focus();      currentElement.classList.add('keyboard-focused');      currentElement.scrollIntoView({        behavior: 'smooth',        block: 'nearest',        inline: 'center'      });            if (e.key === 'Enter' && !currentElement.disabled) {        currentElement.click();      }      previousActiveElement = currentElement;    }  }});function cleanFocusStyles(element) {  if (!element) return;  element.classList.remove('keyboard-focused');  element.blur();}function resetKeyboardMode() {  cleanFocusStyles(previousActiveElement);  keyboardMode = false;  document.body.classList.remove('keyboard-mode');  focusedElementIndex = -1;}document.addEventListener('mousedown', function() {  document.body.classList.remove('keyboard-mode');  if (previousActiveElement) {    cleanFocusStyles(previousActiveElement);  }});function getInteractiveElements() {  if (document.querySelector('.luck-result')) {    return Array.from(document.querySelectorAll('.luck-result button, .luck-result .close-popup'));  }  if (currentSectionId === "section4") {    return Array.from(document.querySelectorAll('.section4-content .answer-wrapper'));  }  if (quizSectionEl.style.display === 'block') {    const elements = [      document.getElementById('back-to-sections'),      document.getElementById('try-my-luck'),      document.getElementById('restart'),      ...Array.from(document.querySelectorAll('.question button'))    ].filter(Boolean);    return elements.filter(el =>       el.offsetParent !== null &&       !el.disabled &&      window.getComputedStyle(el).visibility !== 'hidden'    );  }  if (sectionSelectionEl.style.display === 'block') {    return Array.from(document.querySelectorAll('.section-card'));  }  return [];}document.body.style.background = "transparent";document.querySelectorAll('.section-card').forEach(card => {  card.addEventListener('click', function() {    console.log('Card clicked:', this.dataset.section);    const sectionId = this.dataset.section;    cardClick(this, sectionId);  });});// ==================== SAFETY NET: Prevent accidental page close ====================window.addEventListener('beforeunload', function(e) {  // Only warn if we're actually in edit mode AND have confirmed unsaved changes  if (isEditMode && hasUnsavedChanges) {    e.preventDefault();    e.returnValue = "You have unsaved changes in Edit Mode. Are you sure you want to leave?";    return "You have unsaved changes in Edit Mode. Are you sure you want to leave?";  }  // If no changes, don't set returnValue - browser won't show warning});// ==================== SETTINGS MODAL FUNCTIONS (moved here to fix ReferenceError) ====================function openSettingsModal() {  syncEditModeToggle();  document.getElementById('settings-modal').style.display = 'flex';}function closeSettingsModal() {  document.getElementById('settings-modal').style.display = 'none';}// Settings button handlerdocument.getElementById('settings-btn').addEventListener('click', openSettingsModal);</script><!-- ==================== FULLY DYNAMIC SUNO PLAYLIST (Feb 2026) ==================== --><script>const PLAYLIST_URL = "https://suno.com/playlist/9f94bf76-4e65-4a32-bdb1-8cbe82d148d7";let currentSongs = [];let currentIndex = 0;async function loadSunoPlaylist() {  const meta = document.getElementById('playlist-meta');  meta.textContent = "Loading playlist...";  try {    const proxy = `https://api.allorigins.win/get?url=${encodeURIComponent(PLAYLIST_URL)}`;    const res = await fetch(proxy);    const data = await res.json();    const doc = new DOMParser().parseFromString(data.contents, 'text/html');    const rows = doc.querySelectorAll('.group[data-key]');    currentSongs = Array.from(rows).map(row => {      const id = row.querySelector('[data-clip-id]')?.getAttribute('data-clip-id');      if (!id) return null;      return {        id,        title: row.querySelector('a[href^="/song/"]')?.textContent?.trim() || 'Unknown',        duration: row.querySelector('.font-mono')?.textContent?.trim() || '7:30',        cover: row.querySelector('img')?.src || 'https://cdn2.suno.ai/80988183.jpeg?width=360'      };    }).filter(Boolean);    if (currentSongs.length === 0) throw new Error("No songs");    const channel = doc.querySelector('a[title]')?.textContent?.trim() || 'Suno User';    document.getElementById('playlist-meta').textContent = `${channel} • ${currentSongs.length} songs`;    document.getElementById('song-count').textContent = currentSongs.length;    buildSongList();    if (currentSongs.length > 0) {      playSong(0, false);      setTimeout(startPlaylistMarquee, 800);      hasAutoPlayed = true;    }  } catch (e) {    console.error(e);    meta.innerHTML = `Failed to load.<br><small>Check connection</small>`;  }}function buildSongList() {  const container = document.getElementById('suno-song-list');  container.innerHTML = '';  currentSongs.forEach((song, i) => {    const row = document.createElement('div');    row.className = `song-row ${i === 0 ? 'active selected' : ''}`;    row.innerHTML = `      <img src="${song.cover}" onerror="this.src='https://cdn2.suno.ai/80988183.jpeg?width=360'" alt="">      <div class="info">        <div class="title">${song.title}</div>        <div class="duration">${song.duration}</div>      </div>    `;    row.addEventListener('click', () => { hasAutoPlayed = true; playSong(i, true); });    container.appendChild(row);  });}function playSong(index, autoPlay = true) {  if (index < 0) index = currentSongs.length - 1;  if (index >= currentSongs.length) index = 0;  currentIndex = index;  const song = currentSongs[index];  document.getElementById('playlist-title').textContent = song.title;  startPlaylistMarquee();  document.getElementById('playlist-cover-container').innerHTML = `    <img src="${song.cover}" style="width:100%;height:100%;object-fit:cover;border-radius:10px;"          onerror="this.src='https://cdn2.suno.ai/80988183.jpeg?width=360'">  `;  const iframe = document.getElementById('suno-embed');  iframe.src = `https://suno.com/embed/${song.id}?autoplay=true`;  document.querySelectorAll('.song-row').forEach((r, i) => {    r.classList.toggle('active', i === index);    r.classList.toggle('selected', i === index);  });}function prevSong(e) { if (e) e.stopImmediatePropagation(); playSong(currentIndex - 1); }function nextSong(e) { if (e) e.stopImmediatePropagation(); playSong(currentIndex + 1); }function toggleSunoWidget() {  const widget = document.getElementById('suno-playlist-widget');  widget.classList.toggle('collapsed');  const btn = document.getElementById('suno-toggle-btn');  if (btn) btn.textContent = widget.classList.contains('collapsed') ? '▲' : '▼';}function toggleSongList() {  document.getElementById('suno-song-list').classList.toggle('open');}function triggerInstantPlay() {  if (currentSongs.length > 0 && !hasAutoPlayed) playSong(0, true);}// Keyboard supportdocument.getElementById('suno-playlist-widget').addEventListener('keydown', e => {  if (e.key === 'ArrowRight') nextSong(e);  if (e.key === 'ArrowLeft') prevSong(e);  if (e.key === ' ') { e.preventDefault(); togglePlayPause(e); }});window.addEventListener('load', () => {  loadSunoPlaylist();});// ==================== NEWS-FLASH MARQUEE FOR PLAYLIST TITLE ====================let marqueeTimeout = null;let transitionListener = null;function startPlaylistMarquee() {  const container = document.getElementById('playlist-title-container');  const titleEl = document.getElementById('playlist-title');    if (!container || !titleEl) return;    // Clean up any previous timers/listeners  if (marqueeTimeout) clearTimeout(marqueeTimeout);  if (transitionListener) {    titleEl.removeEventListener('transitionend', transitionListener);    transitionListener = null;  }    const fullWidth = titleEl.scrollWidth;  const visibleWidth = container.clientWidth;    // If text fits completely, just show it static  if (fullWidth <= visibleWidth + 8) {    titleEl.style.transition = 'none';    titleEl.style.transform = 'translateX(0)';    return;  }    const maxScroll = fullWidth - visibleWidth;  const scrollDuration = Math.max(3800, Math.floor(maxScroll * 12.5)); // smooth speed    function cycle() {    // 1. Jump to start + freeze 2 seconds    titleEl.style.transition = 'none';    titleEl.style.transform = 'translateX(0px)';        marqueeTimeout = setTimeout(() => {      // 2. Start scrolling      titleEl.style.transition = `transform ${scrollDuration}ms linear`;      titleEl.style.transform = `translateX(-${maxScroll}px)`;            // 3. Wait until scrolling is 100% finished      transitionListener = function onScrollEnd() {        titleEl.removeEventListener('transitionend', onScrollEnd);        transitionListener = null;                // 4. Now freeze at the END for 2 seconds        marqueeTimeout = setTimeout(() => {          cycle(); // restart loop        }, 2000);      };            titleEl.addEventListener('transitionend', transitionListener);          }, 1650); // start freeze at beginning  }    cycle();}</script><!-- --><script>function updateHeaderCover(song) {  const container = document.getElementById('playlist-cover-container');  if (!container) return;  container.innerHTML = '';  if (song.video) {    const video = document.createElement('video');    video.src = song.video;    video.style.cssText = 'width:100%;height:100%;object-fit:cover;';    video.loop = true;    video.muted = true;    video.autoplay = true;    video.playsInline = true;    container.appendChild(video);  } else {    const img = document.createElement('img');    img.src = song.cover || 'https://cdn2.suno.ai/80988183.jpeg?width=360';    img.style.cssText = 'width:100%;height:100%;object-fit:cover;';    img.alt = '';    img.onerror = () => { img.src = 'https://cdn2.suno.ai/80988183.jpeg?width=360'; };    container.appendChild(img);  }}function updateOverlayVideo(song) {  const overlay = document.getElementById('video-overlay');  const videoEl = document.getElementById('overlay-video');  if (!song.video) {    overlay.style.display = 'none';    if (videoEl) videoEl.pause();    return;  }  videoEl.src = song.video;  videoEl.currentTime = 0;  videoEl.play().catch(() => {});  overlay.style.display = 'block';}</script><!-- Cosmic Background + FINAL Safe Neon System (No White, Perfect Cyan) --><script>let canvas = document.createElement("canvas");canvas.style.cssText = "position:fixed;top:0;left:0;width:100%;height:100%;z-index:-1;pointer-events:none;";document.body.appendChild(canvas);let ctx = canvas.getContext("2d");function resizeCanvas() {  canvas.width = window.innerWidth;  canvas.height = window.innerHeight;}resizeCanvas();window.addEventListener("resize", resizeCanvas);let blobs = Array.from({ length: 40 }, () => ({  x: Math.random() * window.innerWidth,  y: Math.random() * window.innerHeight,  radius: Math.random() * 60 + 40,  dx: (Math.random() - 0.5) * 0.4,  dy: (Math.random() - 0.5) * 0.4}));let globalBlobs = blobs;function drawCosmicField() {  ctx.fillStyle = "#0b0e11";  ctx.fillRect(0, 0, canvas.width, canvas.height);  ctx.globalCompositeOperation = "lighter";  // Get current accent colors from CSS (this makes the picker work)  const rootStyle = getComputedStyle(document.documentElement);  const accent0 = rootStyle.getPropertyValue('--accent-0-rgb').trim();  const accent2 = rootStyle.getPropertyValue('--accent-2-rgb').trim();  const accent4 = rootStyle.getPropertyValue('--accent-4-rgb').trim();  blobs.forEach(blob => {    const gradient = ctx.createRadialGradient(blob.x, blob.y, 0, blob.x, blob.y, blob.radius);    gradient.addColorStop(0, `rgba(${accent0}, 0.32)`);    gradient.addColorStop(0.6, `rgba(${accent2}, 0.08)`);    gradient.addColorStop(1, `rgba(${accent4}, 0)`);    ctx.fillStyle = gradient;    ctx.beginPath();    ctx.arc(blob.x, blob.y, blob.radius, 0, Math.PI * 2);    ctx.fill();    blob.x += blob.dx;    blob.y += blob.dy;    if (blob.x < 0 || blob.x > canvas.width) blob.dx *= -1;    if (blob.y < 0 || blob.y > canvas.height) blob.dy *= -1;  });  ctx.globalCompositeOperation = "source-over";  requestAnimationFrame(drawCosmicField);}drawCosmicField();/* ====================== FINAL SAFE NEON HSL (NEVER WHITE) ====================== */const lightnessLevels = [90, 82, 74, 65, 55, 42, 80, 62, 87, 48]; // tuned to stay vibrant on every huefunction hexToHsl(hex) {  let r = parseInt(hex.slice(1,3),16)/255;  let g = parseInt(hex.slice(3,5),16)/255;  let b = parseInt(hex.slice(5,7),16)/255;  const max = Math.max(r,g,b), min = Math.min(r,g,b);  let h, s, l = (max + min)/2;  if (max === min) h = s = 0;  else {    const d = max - min;    s = l > 0.5 ? d / (2 - max - min) : d / (max + min);    switch(max){      case r: h = (g-b)/d + (g<b?6:0); break;      case g: h = (b-r)/d + 2; break;      case b: h = (r-g)/d + 4; break;    }    h /= 6;  }  return [Math.round(h*360), Math.round(s*100), Math.round(l*100)];}function hslToHex(h, s, l) {  h /= 360; s /= 100; l /= 100;  let r, g, b;  if (s === 0) r = g = b = l;  else {    const hue2rgb = (p,q,t) => {      if(t<0) t+=1; if(t>1) t-=1;      if(t<1/6) return p + (q-p)*6*t;      if(t<1/2) return q;      if(t<2/3) return p + (q-p)*(2/3-t)*6;      return p;    };    const q = l<0.5 ? l*(1+s) : l + s - l*s;    const p = 2*l - q;    r = hue2rgb(p,q,h+1/3);    g = hue2rgb(p,q,h);    b = hue2rgb(p,q,h-1/3);  }  const toHex = x => Math.round(x*255).toString(16).padStart(2,'0');  return '#' + toHex(r) + toHex(g) + toHex(b);}function changeAccentColor(newHex) {  if (!newHex || newHex[0] !== '#' || newHex.length !== 7) return;  const [hue] = hexToHsl(newHex);  const sat = 100;  for (let i = 0; i < 10; i++) {    const newColor = hslToHex(hue, sat, lightnessLevels[i]);    document.documentElement.style.setProperty(`--accent-${i}`, newColor);    const nr = parseInt(newColor.slice(1,3),16);    const ng = parseInt(newColor.slice(3,5),16);    const nb = parseInt(newColor.slice(5,7),16);    document.documentElement.style.setProperty(`--accent-${i}-rgb`, `${nr}, ${ng}, ${nb}`);  }  // Refresh bubbles to match new hue  if (globalBlobs) {    globalBlobs.forEach(blob => {      blob.colorStops = [        `rgba(var(--accent-0-rgb), 0.32)`,        `rgba(var(--accent-2-rgb), 0.08)`,        `rgba(var(--accent-4-rgb), 0)`      ];    });  }}document.addEventListener('DOMContentLoaded', () => {  const picker = document.getElementById('accent-color-picker');  const hexInput = document.getElementById('accent-hex-input');  const settingsBtn = document.getElementById('settings-btn');  if (picker) picker.addEventListener('input', () => { hexInput.value = picker.value; changeAccentColor(picker.value); });  if (hexInput) hexInput.addEventListener('input', () => {    let v = hexInput.value.trim().toUpperCase();    if (v.length === 7 && v[0] === '#') { picker.value = v; changeAccentColor(v); }  });  if (settingsBtn) settingsBtn.addEventListener('click', openSettingsModal);  changeAccentColor('#00ffff'); // perfect original cyan on load});// ====================== SETTINGS → EDIT MODE TOGGLE ======================function handleSettingsEditToggle() {  const checkbox = document.getElementById('edit-mode-toggle');  if (!checkbox) return;    // Only act if state actually changed  if (checkbox.checked !== isEditMode) {    toggleEditMode();   // re-uses your existing function  }}function syncEditModeToggle() {  const checkbox = document.getElementById('edit-mode-toggle');  if (checkbox) checkbox.checked = isEditMode;}</script><!-- Floating Save Button --><button id="floating-save-btn" onclick="saveAsNewFile()">  💾 Save as New File</button><div id="save-success">✅ File saved successfully! Edit Mode turned off.</div><!-- Settings Modal --><div id="settings-modal" class="modal">  <div class="modal-content">    <span class="close-modal" onclick="closeSettingsModal()">×</span>    <h2>Theme Settings</h2>        <div class="setting-item">      <label>Accent Color <span style="font-size:1.4em;">🎨</span></label>      <div style="display:flex; gap:12px; align-items:center; justify-content:center;">        <input type="color" id="accent-color-picker" value="#00ffff" style="width:68px;height:68px;border:none;border-radius:12px;cursor:pointer;">        <input type="text" id="accent-hex-input" value="#00ffff" maxlength="7" style="background:#111;color:#ccc;border:2px solid var(--accent-0);padding:10px 14px;border-radius:8px;font-family:monospace;font-size:1.1em;width:130px;text-align:center;">      </div>      <p style="margin-top:12px;font-size:0.9em;color:#888;">Live preview • Everything updates instantly</p>    </div>    <!-- NEW: Edit Mode Toggle -->    <div class="setting-item">      <div class="toggle-label">        <label>Edit Mode <span style="font-size:1.5em;">✏️</span></label>        <label class="toggle-switch">          <input type="checkbox" id="edit-mode-toggle" onchange="handleSettingsEditToggle()">          <span class="slider"></span>        </label>      </div>    </div>    <!-- NEW: Import Readable TXT Button (only visible in Edit Mode) -->    <div class="setting-item import-txt-group">      <button onclick="importJSONFile()"               style="width:100%; padding:14px 24px; background:var(--accent-0); color:#0d0d0d;                      border:none; border-radius:10px; font-weight:bold; font-size:1.05em;                      cursor:pointer; box-shadow:0 0 15px rgba(var(--accent-0-rgb),0.6);                      transition:all 0.3s ease;">        📥 Import JSON      </button>      <p style="margin-top:8px; font-size:0.85em; color:#888; text-align:center;">        Add new sections & questions (append / merge)      </p>    </div><div class="setting-item">        <button onclick="deleteAllSections()"                 style="width:100%; padding:14px 24px; background:#ff4444; color:#ffffff;                        border:none; border-radius:10px; font-weight:bold; font-size:1.05em;                        cursor:pointer; box-shadow:0 0 15px rgba(255,68,68,0.6); transition:all 0.3s ease;">          🗑️ Delete All Sections        </button>        <p style="margin-top:8px; font-size:0.85em; color:#ff8888; text-align:center;">          ⚠️ Permanent — deletes every section and all data        </p>      </div>    </div>  </div><script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9d36befa685ae1af',t:'MTc3MjAxNzcxOS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body></html>